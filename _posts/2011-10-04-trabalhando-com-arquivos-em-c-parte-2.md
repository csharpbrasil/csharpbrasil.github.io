---
title: 'Trabalhando com Arquivos em C# – Parte 2'
date: Tue, 04 Oct 2011 10:40:53 +0000
draft: false
tags: ['arquivos', 'ASP.NET', 'C#', 'C#', 'filestream', 'streamreader', 'streamwriter', 'system.io', 'windows forms']
---

Olá pessoal, na 2ª parte de nossa série de artigos sobre manipulação de arquivos em C# iremos dar continuidade ao nosso Form criando os métodos dos dois botões restantes, o **Alterar** e o **Excluir**. Faço este artigo com base nas videoaulas de [Bruno Belizário](mailto:bsbelizario@hotmail.com), do [Portal Linha de Código](http://www.linhadecodigo.com.br/), mediante autorização do mesmo. Acompanhem o passo-a-passo: Lembrando que para estes artigos estamos usando as classes [FileStream](http://msdn.microsoft.com/pt-br/library/system.io.filestream%28VS.90%29.aspx), [StreamReader](http://msdn.microsoft.com/pt-br/library/system.io.streamreader%28VS.90%29.aspx) e [StreamWriter](http://msdn.microsoft.com/pt-br/library/system.io.streamwriter%28VS.90%29.aspx), todas contidas no namespace [System.IO](http://msdn.microsoft.com/pt-br/library/system.io%28v=VS.90%29.aspx), que é específico para manipular arquivos. Como dito anteriormente, vamos criar o método do botão **Alterar Arquivo**. Vá à página de códigos e faça o método a seguir, (o mais trabalhoso dos cinco, já que o objetivo aqui é alterar o arquivo sem perder as informações como data de criação): \[sourcecode language="csharp"\] private void Alterar() { try { //Verifico se o arquivo que desejo abrir existe e passo como parâmetro a variável respectiva if (File.Exists(strPathFile)) { //Instancio o FileStream passando como parâmetro a variável padrão, o FileMode que será //o modo Open e o FileAccess, que será Read(somente leitura). Este método é diferente dos //demais: primeiro irei abrir o arquivo, depois criar um FileStream temporário que irá //armazenar os novos dados e depois criarei outro FileStream para fazer a junção dos dois using (FileStream fs = new FileStream(strPathFile, FileMode.Open, FileAccess.Read)) { //Aqui instancio o StreamReader passando como parâmetro o FileStream criado acima. //Uso o StreamReader já que faço 1º a leitura do arquivo. Irei percorrer o arquivo e //quando encontrar uma string qualquer farei a alteração por outra string qualquer using (StreamReader sr = new StreamReader(fs)) { //Crio o FileStream temporário onde irei gravar as informações using (FileStream fsTmp = new FileStream(strPathFile + ".tmp", FileMode.Create, FileAccess.Write)) { //Instancio o StreamWriter para escrever os dados no arquivo temporário, //passando como parâmetro a variável fsTmp, referente ao FileStream criado using (StreamWriter sw = new StreamWriter(fsTmp)) { //Crio uma variável e a atribuo como nula. Faço um while que percorrerá //meu arquivo original e enquanto ele estiver diferente de nulo... string strLinha = null; while ((strLinha = sr.ReadLine()) != null) { //faço um indexof para verificar se existe a palavra adicionado, //se ela existir, a substituo pela palavra alterado if (strLinha.IndexOf("adicionado") > -1) { //uso o método Replace que espera o valor antigo e valor novo strLinha = strLinha.Replace("adicionado", "alterado"); } //Chamo o método Write do StreamWriter passando o strLinha como parâmetro sw.Write(strLinha); } } } } } //Ao final excluo o arquivo anterior e movo o temporário no lugar do original //Dessa forma não perco os dados de modificação de meu arquivo File.Delete(strPathFile); //No método Move passo o arquivo de origem, o temporário, e o de destino, o original File.Move(strPathFile + ".tmp", strPathFile); //Exibo a mensagem ao usuário MessageBox.Show("Arquivo alterado com sucesso!"); } else { //Se não existir exibo a mensagem MessageBox.Show("Arquivo não encontrado!"); } } catch (Exception ex) { MessageBox.Show(ex.Message); } } \[/sourcecode\] Agora dê dois cliques no botão **Alterar Arquivo** e chame o método acima no evento do botão: \[sourcecode language="csharp"\] private void btnAlterar\_Click(object sender, EventArgs e) { Alterar(); } \[/sourcecode\] Salve, compile e clique no botão. Irá aparecer a seguinte mensagem, como mostra a **Figura 01**: [![](http://programandodotnet.files.wordpress.com/2010/06/changedfilemessagebox.jpg)](http://programandodotnet.files.wordpress.com/2010/06/changedfilemessagebox.jpg)

_Figura 01 - Mensagem informando que o arquivo foi alterado_

Agora clique no botão **Abrir Arquivo** e veja a alteração das palavras **adicionado** por **alterado**, como vemos abaixo na **Figura 02**: [![](http://programandodotnet.files.wordpress.com/2010/06/changedfile.jpg)](http://programandodotnet.files.wordpress.com/2010/06/changedfile.jpg)

_Figura 02 - Substituição das palavras adicionado por alterado_

Finalizando os métodos dos botões, vamos criar agora o método **Excluir Arquivo** (o mais simples dos cinco): \[sourcecode language="csharp"\] private void Excluir() { try { //Verifico se o arquivo que desejo abrir existe e passo como parâmetro a variável respectiva if (File.Exists(strPathFile)) { //Se existir chamo o método Delete da classe File para apagá-lo e exibo uma msg ao usuário File.Delete(strPathFile); MessageBox.Show("Arquivo excluído com sucesso!"); } else { //Se não existir exibo a mensagem MessageBox.Show("Arquivo não encontrado!"); } } catch (Exception ex) { MessageBox.Show(ex.Message); } } \[/sourcecode\] Faça o mesmo que antes, dê dois cliques no botão **Excluir Arquivo** e chame o método recém-criado: \[sourcecode language="csharp"\] private void btnExcluir\_Click(object sender, EventArgs e) { Excluir(); } \[/sourcecode\] Salve, compile e clique no botão **Excluir Arquivo**. O arquivo será excluído e aparecerá uma mensagem para você, como podemos ver na **Figura 03**: [![](http://programandodotnet.files.wordpress.com/2010/06/deletedfilemessagebox.jpg)](http://programandodotnet.files.wordpress.com/2010/06/deletedfilemessagebox.jpg)

_Figura 03 - Mensagem informando que o arquivo foi excluído_

Teste se o mesmo foi realmente excluído clicando no botão **Abrir Arquivo** e/ou indo na pasta **C:\\temp**. Veja a mensagem de retorno nas **Figuras 04** e **05**: [![](http://programandodotnet.files.wordpress.com/2010/06/filenotfoundmessagebox.jpg)](http://programandodotnet.files.wordpress.com/2010/06/filenotfoundmessagebox.jpg) [![](http://programandodotnet.files.wordpress.com/2010/06/tempfolder.jpg)](http://programandodotnet.files.wordpress.com/2010/06/tempfolder.jpg)

_Figuras 04 e 05 - Constatação de que o arquivo foi excluído_

Uma boa dica é pra evitar a repetição de código, como feito em nossos **if/else** em que verificamos por diversas vezes se o arquivo existe, senão exibe uma mensagem, o certo seria se criássemos um método que fizesse essa validação, já que desta forma estaríamos diminuindo o tempo de codificação (mesmo que apenas deixássemos de usar o CTRL + C, CTRL + V!). Fica a dica! Assim finalizo a 2ª parte de nosso artigo. Na próxima e última parte criaremos caixas de diálogo em nossa aplicação. Aguardem! **Créditos** à [Bruno Belizário](mailto:bsbelizario@hotmail.com), que fez as videoaulas e ao [Portal Linha de Código](http://www.linhadecodigo.com.br/), por onde pude baixá-las (mediante assinatura), estudá-las e posteriormente fazer este artigo. Quaisquer dúvidas mandem emails para [wellingtonbalbo@gmail.com](mailto:wellingtonbalbo@gmail.com) ou deixem nos comentários deste artigo que responderei o mais rápido possível. _Até o próximo artigo!_