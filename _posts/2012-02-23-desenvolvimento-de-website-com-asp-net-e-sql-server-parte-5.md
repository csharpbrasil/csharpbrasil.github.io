---
title: 'Desenvolvimento de Website com ASP.NET e SQL Server - Parte 5'
date: Thu, 23 Feb 2012 09:24:47 +0000
draft: false
tags: ['.NET', 'acesso a dados', 'ASP.NET', 'ASP.NET', 'C#', 'C#', 'CMS', 'Content Management Systems', 'CSS', 'Desenvolver website', 'Desenvolvimento de Website', 'N-Camadas', 'N-Tier', 'Sistema de gerenciamento de conteúdo', 'Sql Server', 'SQL Server', 'System.Data.OleDb', 'System.Data.SqlClient', 'Visual Studio', 'Visual Studio']
---

Olá caro leitor! Você acompanhou até aqui o desenvolvimento de website com ASP.NET e SQL Server. Se não acompanhou, acesse:

*   [Desenvolvimento de Website com ASP.NET e SQL Server - Parte 1](https://raphaelcardoso.com.br/desenvolvimento-de-website-com-asp-net-e-sql-server-parte-1/ "Desenvolvimento de Website com ASP.NET e SQL Server – Parte 1")
*   [Desenvolvimento de Website com ASP.NET e SQL Server - Parte 2](https://raphaelcardoso.com.br/desenvolvimento-de-website-com-asp-net-e-sql-server-parte-2/ "Desenvolvimento de Website com ASP.NET e SQL Server – Parte 2")
*   [Desenvolvimento de Website com ASP.NET e SQL Server - Parte 3](https://raphaelcardoso.com.br/desenvolvimento-de-website-com-asp-net-e-sql-server-parte-3/ "Desenvolvimento de Website com ASP.NET e SQL Server – Parte 3")
*   [Desenvolvimento de Website com ASP.NET e SQL Server - Parte 4](https://raphaelcardoso.com.br/desenvolvimento-de-website-com-asp-net-e-sql-server-parte-4/ "Desenvolvimento de Website com ASP.NET e SQL Server – Parte 4")
*   [Desenvolvimento de Website com ASP.NET e SQL Server - Parte 5](https://raphaelcardoso.com.br/desenvolvimento-de-website-com-asp-net-e-sql-server-parte-5/ "Desenvolvimento de Website com ASP.NET e SQL Server – Parte 5")

Hoje iremos finalizar nosso projeto realizando o desenvolvimento das funcionalidades principais do nosso painel de controle. Iremos abordar os seguintes tópicos:

*   Criação das telas de gerenciamento de páginas
*   Uso do CK Editor
*   Link para encerrar sessão do usuário

Para iniciarmos, faça o download do fonte do projeto disponibilizado no [Github](https://github.com/csharpbrasil/projeto-website-aspnet).

Na teoria, as funcionalidades para o gerenciamento das páginas serão as mesmas que dos usuários com a diferença que iremos utilizar o CK Editor como nosso editor. Para iniciar, vamos criar a nossa página _gerenciar\_paginas.aspx_. Você já fez isso antes, então não tem segredo. Clique com o botão direito sobre a pasta painel e em seguida _Add new item_. [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0012-300x265.jpg "image001")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0012.jpg) Defina o nome para nossa página. Ela irá se chamar _gerenciar\_paginas.aspx_. [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0022-300x185.jpg "image002")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0022.jpg) Defina a MasterPage. Atente-se a selecionar a MasterPage do painel de controle. [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0032-300x183.jpg "image003")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0032.jpg) A página ficará semelhante à de usuários. Essa página conterá um GridView para listar as páginas. Para preencher esse GridView utilizaremos um _ObjectDataSource_. Então, adicione um _GridView_, um _ObjectDataSource_ e um _Button_. O Button será usado para nos direcionar para a página de cadastro. [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0042-300x161.jpg "image004")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0042.jpg) Clique em cima do _ObjectDataSource_, e clique na seta para selecionar a opção _Configure Data Source_. [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image005-300x97.png "image005")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image005.png) Na janela de configuração selecione o nosso objeto _WebSite.Business.Paginas_ pois é nele que contem nossas regras de negocio. [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0061-300x240.jpg "image006")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0061.jpg) Selecionaremos a opção para _ListaPaginas_. [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0072-300x240.jpg "image007")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0072.jpg) Antes de concluir, clique na aba _DELETE_ e selecione a o método _ExcluiPagina_ e em seguida clique no botão _Finish_ para concluirmos. [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0082-300x240.jpg "image008")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0082.jpg) Agora que temos definido a opção de excluir e listar as páginas, vamos configurar nosso GridView. Para isso associaremos no GridView o ObjectDataSource. Clique no GridView e na seta que aparece no canto superior direito clique e seleciona o ObjectDataSource na opção _Choose Data Source_. Aproveite e selecione as opções _Enable Paging_ e _Enable Deleting_. Essas opções irão habilitar a paginação e o link para excluir registro. [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0092-300x191.jpg "image009")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0092.jpg) Vamos definir no GridView qual é o _DataKeyNames_. No nosso caso informaremos _DataKeysName_ igual _Id_ e foi como fizemos no caso dos usuários. Assim sendo, estamos informando ao GridView que a chave de cada registro será o _Id_ e essa será utilizada quando formos excluir algum registro. Para definir o DataKeyNames, clique no GridView e vá em _properties_. [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image010-156x300.png "image010")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image010.png) É possível definir mais de um, mais nesse caso não será necessário. Agora defina um estilo para o GridView. [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image011-300x147.jpg "image011")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image011.jpg) Agora já temos nosso resultado. [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0121-300x161.jpg "image012")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0121.jpg) Vamos definir a funcionalidade do nosso botão Nova página. De duplo clique e vamos atribuir o evento. \[sourcecode language='csharp'\] protected void btnNovaPagina\_Click(object sender, EventArgs e) { Response.Redirect("editar\_pagina.aspx"); } \[/sourcecode\] Crie uma nova página. Ela deverá se chamar _editar\_pagina.aspx_. [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image013-241x300.png "image013")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image013.png) [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0141-300x185.jpg "image014")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0141.jpg) Defina a MasterPage do painel de controle. [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0151-300x183.jpg "image015")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0151.jpg) Antes de darmos continuidade, nessa página iremos precisar do CKEditor e para isso precisaremos realizar o download. Faça o download do _CKEditor_ e do _CKEditor for ASP.NET_. Ele será usado como nosso editor HTML. Acesse o link direto da versão utilizada:

*   [CKEditor](http://download.cksource.com/CKEditor/CKEditor/CKEditor%203.6.2/ckeditor_3.6.2.zip)
*   [CKEditor for ASP.NET](http://download.cksource.com/CKEditor/CKEditor.NET/CKEditor.NET%203.6.2/ckeditor_aspnet_3.6.2.zip)

Agora adicionaremos o _CKEditor for ASP.NET_ ao nossa Toolbox do Visual Studio. Descompacte o arquivo que fizemos o download. Clique em Add Tab, defina o nome e em seguida clique em _Choose Item_. [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image016-156x300.png "image016")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image016.png) Procure o arquivo do _CKEditor_ e adicione. [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0171-300x215.jpg "image017")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0171.jpg) Agora é só utiliza-lo em nosso projeto. [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image018-278x300.png "image018")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image018.png) Agora abra a página _editar\_pagina.aspx_ para adicionarmos os campos necessários para a edição da pagina. Inclua 1 _HiddenField_, 1 _TextBox_, 1 _CheckBox_, 2 _Button_ e o _CKEditor_ conforme o código abaixo. \[sourcecode language='html'\]

### Nova página

  
Titulo  
Texto  

  
\[/sourcecode\] Se você executar a página agora, o _CKEditor for ASP.NET_ não irá ser exibido. Para isso precisaremos copiar o _CKEditor_ que realizamos o download para dentro do nosso projeto. Abra a pasta onde está salvo o projeto e copie para a raiz. [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0191-300x207.jpg "image019")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0191.jpg) Agora sim nosso _CKEditor_ irá aparecer. [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0201-300x161.jpg "image020")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0201.jpg) O CKEditor possui muitas funcionalidades, mais muitas delas serão desnecessárias para nós nesse momento. Como desativar? Basta editar a propriedade _ToolbarFull_. Altere o conteúdo da propriedade incluindo o texto abaixo: \[sourcecode language='html'\] Cut|Copy|Paste|PasteText|PasteFromWord|-|Print|SpellChecker|Scayt|Undo|Redo|-|Find|Replace|-|SelectAll / Bold|Italic|Underline|Strike|-|Subscript|Superscript|NumberedList|BulletedList|-|Outdent|Indent| Blockquote|JustifyLeft|JustifyCenter|JustifyRight|JustifyBlock|Link|Unlink|Anchor|Image|Table| HorizontalRule|Smiley|SpecialChar / Styles|Format|Font|FontSize|TextColor|BGColor|Maximize|Source \[/sourcecode\] Agora ficou assim nosso editor. [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0211-300x161.jpg "image021")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0211.jpg) Com a nossa página definida, vamos implementar nosso código. No CodeBehind da página, adiciona referencia a nossa classe de negocio e de entidades. \[sourcecode language='csharp'\] using UsuariosBO = WebSite.Business.Usuarios; using Usuarios = WebSite.Entities.Usuarios; \[/sourcecode\] Agora daremos um duplo clique no botão Salvar para implementarmos o código que salvará os dados da nova página. O código do botão ficara assim. \[sourcecode language='csharp'\] protected void btnSalvar\_Click(object sender, EventArgs e) { int Id; int.TryParse(hdfId.Value, out Id); string Titulo = txtTitulo.Text; string Texto = txtTexto.Text; bool Ativo = chkAtivo.Checked; Paginas pagina = new Paginas(); pagina.Id = Id; pagina.Titulo = Titulo; pagina.Texto = Texto; pagina.Ativo = Ativo; PaginasBO paginasBO = new PaginasBO(); bool Salvou = paginasBO.SalvaPagina(pagina); if (Salvou) { Response.Redirect("gerenciar\_paginas.aspx"); } } \[/sourcecode\] No código estamos recebendo todos os dados e os atribuindo na classe _Paginas_ para posteriormente salva-lo. Após ser salvo, seremos redirecionados para a página que lista todas as nossas páginas criadas. Vamos atribuir código ao botão cancelar para que o usuário possa desistir de editar os dados. De duplo clique sobre o botão Cancelar. \[sourcecode language='csharp'\] protected void btnCancelar\_Click(object sender, EventArgs e) { Response.Redirect("gerenciar\_paginas.aspx"); } \[/sourcecode\] Como ficará nosso código HTML. \[sourcecode language='html'\] <%@ Page Title="" Language="C#" MasterPageFile="~/painel/MasterPage.master" AutoEventWireup="true" CodeFile="editar\_pagina.aspx.cs" Inherits="painel\_editar\_pagina" %> <%@ Register Assembly="CKEditor.NET" Namespace="CKEditor.NET" TagPrefix="CKEditor" %> 

### Nova página

  
Titulo  
Texto  

  
\[/sourcecode\] E o código CodeBehind ficará dessa forma. \[sourcecode language='csharp'\] using System; using System.Collections.Generic; using System.Linq; using System.Web; using System.Web.UI; using System.Web.UI.WebControls; using PaginasBO = WebSite.Business.Paginas; using Paginas = WebSite.Entities.Paginas; public partial class painel\_editar\_pagina : System.Web.UI.Page { protected void Page\_Load(object sender, EventArgs e) { } protected void btnSalvar\_Click(object sender, EventArgs e) { int Id; int.TryParse(hdfId.Value, out Id); string Titulo = txtTitulo.Text; string Texto = txtTexto.Text; bool Ativo = chkAtivo.Checked; Paginas pagina = new Paginas(); pagina.Id = Id; pagina.Titulo = Titulo; pagina.Texto = Texto; pagina.Ativo = Ativo; PaginasBO paginasBO = new PaginasBO(); bool Salvou = paginasBO.SalvaPagina(pagina); if (Salvou) { Response.Redirect("gerenciar\_paginas.aspx"); } } protected void btnCancelar\_Click(object sender, EventArgs e) { Response.Redirect("gerenciar\_paginas.aspx"); } } \[/sourcecode\] Vamos implementar agora a página para que seja possível editar as páginas criadas. Clique sobre o GridView da página de gerencia e clique na seta no canto superior direito em seguinda clique no link _Edit Column_. [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0221-300x187.jpg "image022")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0221.jpg) [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0231-300x230.jpg "image023")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0231.jpg) Selecione um _HyperLinkField_ e adicione. Mova até o inicio da lista. Selecione o _HyperLinkField_ adicionado e defina o _Text_, _DataNavigationUrlFields_ e _DataNavigationUrlFormat_ e em seguida clique no botão OK. Teste a página. Será necessário agora implementarmos em nossa página de edição de páginas a opção para receber uma _QueryString_ para buscar os dados. Vamos implementar o _Page\_Load_. \[sourcecode language='csharp'\] protected void Page\_Load(object sender, EventArgs e) { if (!IsPostBack) { if (Request.QueryString\["id"\] != null) { int Id; int.TryParse(Request.QueryString\["id"\], out Id); PaginasBO paginasBO = new PaginasBO(); Paginas pagina = paginasBO.ListaPaginas(new Paginas(Id)).FirstOrDefault(); hdfId.Value = pagina.Id.ToString(); txtTitulo.Text = pagina.Titulo; txtTexto.Text = pagina.Texto; chkAtivo.Checked = pagina.Ativo; } } } \[/sourcecode\] Agora teste sua página. [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0241-300x161.jpg "image024")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0241.jpg) [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0251-300x161.jpg "image025")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0251.jpg) [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0261-300x161.jpg "image026")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0261.jpg) [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image027-300x161.jpg "image027")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image027.jpg) Agora o resultado da edição de uma das minhas páginas. [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0281-300x161.jpg "image028")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0281.jpg) Existe um detalhe importante que não mencionei. As páginas que eu desativo continuam aparecer. Vamos mudar o código do nosso menu. No foreach que monta o menu, vamos fazer um verificação se a página está ativa. Veja como fica o código. \[sourcecode language='csharp'\] protected void Page\_Load(object sender, EventArgs e) { // Instancia da classe de Negocio WebSite.Business.Paginas paginasBO = new WebSite.Business.Paginas(); // Chamada ao metodo que lista todas as paginas que irá gerar um array das mesmas WebSite.Entities.Paginas\[\] paginas = paginasBO.ListaPaginas(); // Realizando um laço de repetição no array para ler cada registro foreach (WebSite.Entities.Paginas pagina in paginas) { if (pagina.Ativo) { // Formatando a string para que seja gerado uma saida conforme exemplo //*   Titulo Pagina
string mnu = string.Format("*   [{1}](\"pagina.aspx?id={0}\")
", pagina.Id, pagina.Titulo); // Atribuindo o texto gerado no Server Control Literal ltlItensMenu.Text += mnu; } } } \[/sourcecode\] Agora para finalizar crie uma página chamado _sair.aspx_. Essa não necessita ser utilizando a MasterPage pois ela será usada para encerrar a sessão do painel de controle. [![](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0291-300x185.jpg "image029")](https://raphaelcardoso.com.br/wp-content/uploads/2012/02/image0291.jpg) Agora vamos implementar o código no evento Page\_Load que irá destruir a Session relacionada ao login do usuário. \[sourcecode language='csharp'\] protected void Page\_Load(object sender, EventArgs e) { Session.Remove("PainelAutenticado"); Session.Remove("Usuario"); Response.Redirect("login.aspx"); } \[/sourcecode\] Assim concluímos o projeto proposto. Se você acha que ele para por ai, você tem inúmeras possibilidade basta ter criatividade e implementar em seu projeto. Espero ter sido claro ao longo dos artigos e que não tenha deixado nenhuma dúvida. Fiquem a vontade de abrir um tópico no Forum para postar suas dúvidas e discutir as melhores praticas no desenvolvimento de um projeto com ASP.NET. Podem postar comentários que estarei pronto para responder.

Fonte do projeto: [Github](https://github.com/csharpbrasil/projeto-website-aspnet)

Não deixe de participar do fórum. Siga o C# Brasil no Twitter e Facebook. Até o próximo artigo e bons estudos!