---
title: 'Detectando MIME types com C#'
date: Thu, 22 Nov 2012 01:24:42 +0000
draft: false
tags: ['ASP.NET', 'C#', 'Detectando MIME types', 'Dicas']
---

Normalmente em alguns aplicativos temos a necessidade de detectar o [MIME type](http://en.wikipedia.org/wiki/MIME) de determinados arquivos. Segue abaixo uma classe MimeHelper que pode nos ajudar nessa tarefa, uma nota interessante foi a utilização de [Reflection](http://msdn.microsoft.com/en-us/library/ms173183%28v=vs.80%29.aspx) e a classe [MimeMapping](http://msdn.microsoft.com/pt-br/library/system.web.mimemapping.aspx).  
  
\[sourcecode language='csharp'\] using System; using System.Collections.Generic; using System.Linq; using System.Reflection; using System.Text; using System.Web; namespace WebHelpers { public static class MimeHelper { private static readonly object \_locker = new object(); private static object \_mimeMapping; private static readonly MethodInfo \_getMimeMappingMethodInfo; static MimeHelper() { Type mimeMappingType = Assembly.GetAssembly(typeof(HttpRuntime)).GetType("System.Web.MimeMapping"); if (mimeMappingType == null) throw new SystemException("Não foi possível encontrar o tipo MimeMapping."); \_getMimeMappingMethodInfo = mimeMappingType.GetMethod("GetMimeMapping", BindingFlags.Static | BindingFlags.NonPublic | BindingFlags.Public); if (\_getMimeMappingMethodInfo == null) throw new SystemException("Não foi possível encontrar o método GetMimeMapping."); if (\_getMimeMappingMethodInfo.ReturnType != typeof(string)) throw new SystemException("Método GetMimeMapping retornou um tipo inválido."); if (\_getMimeMappingMethodInfo.GetParameters().Length != 1 && \_getMimeMappingMethodInfo.GetParameters()\[0\].ParameterType != typeof(string)) throw new SystemException("Método GetMimeMapping possui parâmentros inválidos."); } public static string GetMimeType(string filename) { lock (\_locker) return (string)\_getMimeMappingMethodInfo.Invoke(\_mimeMapping, new object\[\] { filename }); } } } \[/sourcecode\] Testando: \[sourcecode language='csharp'\] using System; using System.IO; using System.Reflection; using System.Windows.Forms; using Microsoft.VisualStudio.TestTools.UnitTesting; using WebHelpers; namespace WebHelpers.Test { \[TestClass()\] public class MimeHelperTest { /// /// A test for GetMimeType /// \[TestMethod()\] public void GetMimeTypeTextPlainTest() { string filename = Path.Combine(@"C:\\Visual Studio 2008\\Projects\\WebHelpers\\WebHelpers.Test\\", "Files\\\\test.txt"); string expected = "text/plain"; string actual; actual = MimeHelper.GetMimeType(filename); Assert.AreEqual(expected, actual); } \[TestMethod()\] public void GetMimeTypeImageJpegTest() { string filename = Path.Combine(@"C:\\Visual Studio 2008\\Projects\\WebHelpers\\WebHelpers.Test\\", "Files\\\\test.JpG"); string expected = "image/jpeg"; string actual; actual = MimeHelper.GetMimeType(filename); Assert.AreEqual(expected, actual); } \[TestMethod()\] public void GetMimeTypeApplicationOctetStreamTest() { string filename = Path.Combine(@"C:\\Visual Studio 2008\\Projects\\WebHelpers\\WebHelpers.Test\\", "Files\\\\test.mp4"); string expected = "application/octet-stream"; string actual; actual = MimeHelper.GetMimeType(filename); Assert.AreEqual(expected, actual); } } } \[/sourcecode\]