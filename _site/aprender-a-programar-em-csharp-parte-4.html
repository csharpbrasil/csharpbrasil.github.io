<!DOCTYPE html>
<html>

<head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-T668JSDW');</script>
    <!-- End Google Tag Manager -->

	<!-- Meta -->
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Aprender a programar em C# – Parte 4 | C# Brasil</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="Aprender a programar em C# – Parte 4" />
<meta name="author" content="Raphael Cardoso" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="No parte anterior dessa série de artigos que abordamos como Aprender a Programar em C#, você viu um pouco sobre a linguagem C# (C-Sharp) de como ela surgiu, tipos de dados, sintaxes, variáveis, operadores, controle de fluxo e laços de repetição, também pode ver um pouco sobre o desenvolvimento de uma aplicação e a compilação por linha de comando e também viu o desenvolvimento utilizando o Visual Studio." />
<meta property="og:description" content="No parte anterior dessa série de artigos que abordamos como Aprender a Programar em C#, você viu um pouco sobre a linguagem C# (C-Sharp) de como ela surgiu, tipos de dados, sintaxes, variáveis, operadores, controle de fluxo e laços de repetição, também pode ver um pouco sobre o desenvolvimento de uma aplicação e a compilação por linha de comando e também viu o desenvolvimento utilizando o Visual Studio." />
<link rel="canonical" href="http://localhost:4000/aprender-a-programar-em-csharp-parte-4" />
<meta property="og:url" content="http://localhost:4000/aprender-a-programar-em-csharp-parte-4" />
<meta property="og:site_name" content="C# Brasil" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-09-29T07:30:00-03:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Aprender a programar em C# – Parte 4" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Raphael Cardoso","url":"http://www.csharpbrasil.com.br"},"dateModified":"2016-09-29T07:30:00-03:00","datePublished":"2016-09-29T07:30:00-03:00","description":"No parte anterior dessa série de artigos que abordamos como Aprender a Programar em C#, você viu um pouco sobre a linguagem C# (C-Sharp) de como ela surgiu, tipos de dados, sintaxes, variáveis, operadores, controle de fluxo e laços de repetição, também pode ver um pouco sobre o desenvolvimento de uma aplicação e a compilação por linha de comando e também viu o desenvolvimento utilizando o Visual Studio.","headline":"Aprender a programar em C# – Parte 4","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/aprender-a-programar-em-csharp-parte-4"},"url":"http://localhost:4000/aprender-a-programar-em-csharp-parte-4"}</script>
<!-- End Jekyll SEO tag -->


	<!-- CSS & fonts -->
	<link rel="stylesheet" href="/css/main.css?1717257970198203784">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,800" rel="stylesheet" type="text/css">

    <link rel="shortcut icon" href="/images/favicon.png" />
</head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NS9JFVVY3Z"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NS9JFVVY3Z');
</script>

<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T668JSDW"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

	<div id="wrap">
	  	
    <!-- Navigation -->
    <nav id="nav">
	<div id="nav-list">
		<a href="http://localhost:4000/">Página inicial</a>
		<a href="http://localhost:4000/sobre">Sobre o blog</a>
	</div>
</nav>

    
    <!-- Icon menu -->
	  <a id="nav-menu">
	  	<div id="menu"></div>
	  </a>
    <!-- Header -->
    <header id="header">
	<a href="http://localhost:4000/">
		<img src="/images/logo_csharpbrasil.png" class="logo" alt="C# Brasil">
	</a>
</header>

    <!-- Main content -->
	  <div id="container">
      <main>
        <article id="post-page">
	<h2>Aprender a programar em C# – Parte 4</h2>		
	<time datetime="2016-09-29T07:30:00-03:00" class="by-line">
		
		29
		Setembro
		  
		2016
	</time>
	<div class="content">

		<p>No parte anterior dessa série de artigos que abordamos como Aprender a Programar em C#, você viu um pouco sobre a linguagem C# (C-Sharp) de como ela surgiu, tipos de dados, sintaxes, variáveis, operadores, controle de fluxo e laços de repetição, também pode ver um pouco sobre o desenvolvimento de uma aplicação e a compilação por linha de comando e também viu o desenvolvimento utilizando o Visual Studio.</p>

<ul>
  <li><a href="/aprender-a-programar-em-csharp-parte-1">Aprender a programar em C# - Parte 1</a></li>
  <li><a href="/aprender-a-programar-em-csharp-parte-2">Aprender a programar em C# - Parte 2</a></li>
  <li><a href="/aprender-a-programar-em-csharp-parte-3">Aprender a programar em C# - Parte 3</a></li>
</ul>

<p>Nessa nova parte, iremos abordar o desenvolvimento de uma aplicação C# utilizando o Visual Studio, porém essa aplicação irá utilizar banco de dados SQL Server, ou seja, criaremos uma simples aplicação que realizar CRUD (Create, Read, Update e Delete) em um banco de dados. Se você não conhece nada de banco de dados, é uma oportunidade para começar a aprender. Imaginando que você conhece banco de dados, em especial o SQL Server, que também sabe utilizar o SQL Server Manager e já tenha uma instancia do SQL Server ou SQL Server Express instalado, vamos criar a tabela de clientes. Abra seu SQL Manager e crie a tabela utilizando o script sql abaixo.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">CLIENTES</span>
<span class="p">(</span>
    <span class="n">ID</span> <span class="nb">INT</span> <span class="k">IDENTITY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">NOME</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">DATA_NASCIMENTO</span> <span class="nb">DATETIME</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="n">EMAIL</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">CONSTRAINT</span> <span class="n">PK_CLIENTES</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">ID</span><span class="p">)</span>
<span class="p">)</span>
<span class="k">GO</span>
</code></pre></div></div>

<p>Vamos incluir também em nossa alguns registros iniciais.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">CLIENTES</span> <span class="p">(</span><span class="n">NOME</span><span class="p">,</span><span class="n">DATA_NASCIMENTO</span><span class="p">,</span><span class="n">EMAIL</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Ferris Q. Finley'</span><span class="p">,</span><span class="s1">'1997/06/08'</span><span class="p">,</span><span class="s1">'interdum.ligula.eu@egestas.edu'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">CLIENTES</span> <span class="p">(</span><span class="n">NOME</span><span class="p">,</span><span class="n">DATA_NASCIMENTO</span><span class="p">,</span><span class="n">EMAIL</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Taylor H. Stone'</span><span class="p">,</span><span class="s1">'1986/06/02'</span><span class="p">,</span><span class="s1">'amet.dapibus@sedleoCras.edu'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">CLIENTES</span> <span class="p">(</span><span class="n">NOME</span><span class="p">,</span><span class="n">DATA_NASCIMENTO</span><span class="p">,</span><span class="n">EMAIL</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Meredith U. Cote'</span><span class="p">,</span><span class="s1">'1992/12/20'</span><span class="p">,</span><span class="s1">'purus@nullavulputate.org'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">CLIENTES</span> <span class="p">(</span><span class="n">NOME</span><span class="p">,</span><span class="n">DATA_NASCIMENTO</span><span class="p">,</span><span class="n">EMAIL</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Orla Y. Stout'</span><span class="p">,</span><span class="s1">'1981/04/27'</span><span class="p">,</span><span class="s1">'ante@dignissim.edu'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">CLIENTES</span> <span class="p">(</span><span class="n">NOME</span><span class="p">,</span><span class="n">DATA_NASCIMENTO</span><span class="p">,</span><span class="n">EMAIL</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Susan F. Sanford'</span><span class="p">,</span><span class="s1">'1995/04/08'</span><span class="p">,</span><span class="s1">'ut.aliquam@arcuvelquam.edu'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">CLIENTES</span> <span class="p">(</span><span class="n">NOME</span><span class="p">,</span><span class="n">DATA_NASCIMENTO</span><span class="p">,</span><span class="n">EMAIL</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Kennedy Y. Carr'</span><span class="p">,</span><span class="s1">'1986/12/22'</span><span class="p">,</span><span class="s1">'dolor@arcuCurabiturut.co.uk'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">CLIENTES</span> <span class="p">(</span><span class="n">NOME</span><span class="p">,</span><span class="n">DATA_NASCIMENTO</span><span class="p">,</span><span class="n">EMAIL</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Baker X. Mckee'</span><span class="p">,</span><span class="s1">'1983/08/09'</span><span class="p">,</span><span class="s1">'nascetur@Donecatarcu.org'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">CLIENTES</span> <span class="p">(</span><span class="n">NOME</span><span class="p">,</span><span class="n">DATA_NASCIMENTO</span><span class="p">,</span><span class="n">EMAIL</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Sade R. Pitts'</span><span class="p">,</span><span class="s1">'1994/06/14'</span><span class="p">,</span><span class="s1">'commodo.tincidunt.nibh@non.co.uk'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">CLIENTES</span> <span class="p">(</span><span class="n">NOME</span><span class="p">,</span><span class="n">DATA_NASCIMENTO</span><span class="p">,</span><span class="n">EMAIL</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Judah M. Farrell'</span><span class="p">,</span><span class="s1">'1993/08/17'</span><span class="p">,</span><span class="s1">'Maecenas@massa.co.uk'</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">CLIENTES</span> <span class="p">(</span><span class="n">NOME</span><span class="p">,</span><span class="n">DATA_NASCIMENTO</span><span class="p">,</span><span class="n">EMAIL</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'Maya N. Singleton'</span><span class="p">,</span><span class="s1">'1986/11/03'</span><span class="p">,</span><span class="s1">'erat.eget@arcuAliquamultrices.org'</span><span class="p">);</span>
</code></pre></div></div>

<p>Com o banco de dados pronto, já podemos iniciar o desenvolvimento.</p>

<p><img src="/contents/2015/06/aprender_programar_csharp_parte4_001.png" alt="aprender_programar_csharp_parte4_001" /></p>

<p>Sugiro para o desenvolvimento desse projeto o <a href="visualstudio.microsoft.com">Visual Studio Community</a> porque alem de gratuito, ele é completo e atende bem as nossas necessidades. Para efetuar o download, basta ir diretamente no site do Visual Studio acessando o link <a href="visualstudio.microsoft.com">visualstudio.microsoft.com</a>.</p>

<p><img src="/contents/2016/09/aprender_programar_csharp_parte4_002-1.png" alt="aprender_programar_csharp_parte4_002" /></p>

<p>Dando continuidade, abra o Visual Studio e clique no menu <em>File &gt; New &gt; Project</em> e escolha o template <em>Windows Desktop &gt; Windows Forms Application</em>. Para nosso projeto também utilizaremos o <em>.NET Framework 4.5</em>. Defina o nome do projeto como <strong>ProgramarCSharpComBancoDados</strong>.</p>

<p><img src="/contents/2015/06/aprender_programar_csharp_parte4_003.png" alt="aprender_programar_csharp_parte4_003" /></p>

<p>No template escolhido, já teremos um Form criado na qual iremos adicionar 1 DataGridView e 4 Button. Precisaremos alterar o nome dos nossos objetos. Para fazer isso, clique com o botão direito em cima do objeto que deseja e altere a propriedade “(Name)” de cada objeto.</p>

<p><img src="/contents/2015/07/aprender_programar_csharp_parte4_005.png" alt="aprender_programar_csharp_parte4_005" /></p>

<p>Para o DataGridView defina o nome como gridClientes,para o primeiro botão que usado para para listar os clientes no grid defina o nome como btnListar, o segundo será para excluir e terá o nome de btnExcluir, o terceiro será para editar e terá o nome de btnEditar e o quarto botão será para incluir um novo cliente e terá o nome de btnNovo. A posição dos componentes em tela não fará diferença. Distribua os objetos da forma que achar conveniente.</p>

<p><img src="/contents/2015/06/aprender_programar_csharp_parte4_004.png" alt="aprender_programar_csharp_parte4_004" /></p>

<p>Agora adicione vamos adicionar a Connection String no App.config da aplicação. Acesse o Solution Explorer, localize o App.Config e dê um duplo clique sobre ele para que possamos incluir a linha abaixo:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;connectionStrings&gt;</span>
  <span class="nt">&lt;add</span> <span class="na">name=</span><span class="s">"DbConnection"</span> <span class="na">connectionString=</span><span class="s">"Data Source=&lt;seu_servidor&gt;;User Id=&lt;seu_usuario&gt;;Password=&lt;sua_senha&gt;;Initial Catalog=&lt;seu_bancodados&gt;"</span> <span class="na">providerName=</span><span class="s">"System.Data.SqlClient"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/connectionStrings&gt;</span>
</code></pre></div></div>

<p>Adicionaremos a biblioteca <em>System.Configuration.dll</em> clicando com botão direito sobre a pasta <em>References</em> e <em>Add References</em>.</p>

<p><img src="/contents/2016/09/aprender_programar_csharp_parte4_006-1.png" alt="aprender_programar_csharp_parte4_006" /></p>

<p>Vamos começar a codificar atribuindo as operações de consulta, exclusão, edição e inclusão para os respectivos botões. Para inicio, dê um duplo clique no botão Listar e realize a codificação conforme abaixo:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">btnListar_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">dataTable</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DataTable</span><span class="p">();</span>

    <span class="c1">// Retorna para a variavel a ConnectionString configurada no App.Config</span>
    <span class="kt">var</span> <span class="n">connectionString</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">Configuration</span><span class="p">.</span><span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">ConnectionStrings</span><span class="p">[</span><span class="s">"DbConnection"</span><span class="p">].</span><span class="n">ConnectionString</span><span class="p">;</span>

    <span class="c1">// Cria uma instancia de conexão com o banco de dados</span>
    <span class="k">using</span> <span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">SqlClient</span><span class="p">.</span><span class="n">SqlConnection</span> <span class="n">connection</span> <span class="p">=</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">SqlClient</span><span class="p">.</span><span class="nf">SqlConnection</span><span class="p">(</span><span class="n">connectionString</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="c1">// Abre a conexão</span>
        <span class="n">connection</span><span class="p">.</span><span class="nf">Open</span><span class="p">();</span>

        <span class="c1">// Cria uma instancia do command</span>
        <span class="k">using</span> <span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">SqlClient</span><span class="p">.</span><span class="n">SqlCommand</span> <span class="n">command</span> <span class="p">=</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">SqlClient</span><span class="p">.</span><span class="nf">SqlCommand</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="c1">// Comando SQL que será executado</span>
            <span class="kt">var</span> <span class="n">_sqlQuery</span> <span class="p">=</span> <span class="s">"SELECT * FROM CLIENTES"</span><span class="p">;</span>

            <span class="n">command</span><span class="p">.</span><span class="n">Connection</span> <span class="p">=</span> <span class="n">connection</span><span class="p">;</span>
            <span class="n">command</span><span class="p">.</span><span class="n">CommandText</span> <span class="p">=</span> <span class="n">_sqlQuery</span><span class="p">;</span>

            <span class="c1">// Adiciona o resultado em um DataTable</span>
            <span class="k">using</span> <span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">SqlClient</span><span class="p">.</span><span class="n">SqlDataAdapter</span> <span class="n">adapter</span> <span class="p">=</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">SqlClient</span><span class="p">.</span><span class="nf">SqlDataAdapter</span><span class="p">(</span><span class="n">command</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">adapter</span><span class="p">.</span><span class="nf">Fill</span><span class="p">(</span><span class="n">dataTable</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// Fecha conexão</span>
        <span class="n">connection</span><span class="p">.</span><span class="nf">Close</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// Atribui o resultado ao grid</span>
    <span class="n">gridClientes</span><span class="p">.</span><span class="n">DataSource</span> <span class="p">=</span> <span class="n">dataTable</span><span class="p">;</span>
    <span class="c1">// Gera automaticamente as colunas</span>
    <span class="n">gridClientes</span><span class="p">.</span><span class="n">AutoGenerateColumns</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
    <span class="c1">// Muda o modo de seleção da grid para linha inteira</span>
    <span class="n">gridClientes</span><span class="p">.</span><span class="n">SelectionMode</span> <span class="p">=</span> <span class="n">DataGridViewSelectionMode</span><span class="p">.</span><span class="n">FullRowSelect</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Para realizar o teste, basta apertar F5 ou clicar no menu <em>Debug &gt; Start Debugging</em>.</p>

<p><img src="/contents/2016/09/aprender_programar_csharp_parte4_007-1.png" alt="aprender_programar_csharp_parte4_007" /></p>

<p>Agora vamos codificar o botão Excluir clicando duas vezes sobre ele e atribuindo o código baixo:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">btnExcluir_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">gridClientes</span><span class="p">.</span><span class="n">SelectedRows</span><span class="p">.</span><span class="n">Count</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Pega o ID da primeira coluna da linha selecionada e converte para Integer</span>
        <span class="kt">int</span> <span class="n">id</span><span class="p">;</span>
        <span class="kt">int</span><span class="p">.</span><span class="nf">TryParse</span><span class="p">(</span><span class="n">gridClientes</span><span class="p">.</span><span class="n">SelectedRows</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Cells</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Value</span><span class="p">.</span><span class="nf">ToString</span><span class="p">(),</span> <span class="k">out</span> <span class="n">id</span><span class="p">);</span>

        <span class="c1">// Retorna para a variavel a ConnectionString configurada no App.Config</span>
        <span class="kt">var</span> <span class="n">connectionString</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">Configuration</span><span class="p">.</span><span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">ConnectionStrings</span><span class="p">[</span><span class="s">"DbConnection"</span><span class="p">].</span><span class="n">ConnectionString</span><span class="p">;</span>

        <span class="c1">// Cria uma instancia de conexão com o banco de dados</span>
        <span class="k">using</span> <span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">SqlClient</span><span class="p">.</span><span class="n">SqlConnection</span> <span class="n">connection</span> <span class="p">=</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">SqlClient</span><span class="p">.</span><span class="nf">SqlConnection</span><span class="p">(</span><span class="n">connectionString</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="c1">// Abre a conexão</span>
            <span class="n">connection</span><span class="p">.</span><span class="nf">Open</span><span class="p">();</span>

            <span class="c1">// Cria uma instancia do command</span>
            <span class="k">using</span> <span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">SqlClient</span><span class="p">.</span><span class="n">SqlCommand</span> <span class="n">command</span> <span class="p">=</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">SqlClient</span><span class="p">.</span><span class="nf">SqlCommand</span><span class="p">())</span>
            <span class="p">{</span>
                <span class="c1">// Comando SQL que será executado</span>
                <span class="kt">var</span> <span class="n">_sqlQuery</span> <span class="p">=</span> <span class="s">"DELETE FROM CLIENTES WHERE ID = @ID"</span><span class="p">;</span>

                <span class="n">command</span><span class="p">.</span><span class="n">Connection</span> <span class="p">=</span> <span class="n">connection</span><span class="p">;</span>
                <span class="n">command</span><span class="p">.</span><span class="n">CommandText</span> <span class="p">=</span> <span class="n">_sqlQuery</span><span class="p">;</span>
                <span class="n">command</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span> <span class="n">id</span><span class="p">);</span>

                <span class="c1">// Executa a query</span>
                <span class="n">command</span><span class="p">.</span><span class="nf">ExecuteNonQuery</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="c1">// Fecha conexão</span>
            <span class="n">connection</span><span class="p">.</span><span class="nf">Close</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">// Invoca o botão listar</span>
        <span class="nf">btnListar_Click</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Para os botões de Editar e Novo vamos criar um segundo formulário que terá os campos que deverão ser preenchidos. Clique com o botão direto sobre o projeto e depois selecione <em>Add &gt; Windows Form</em>.</p>

<p><img src="/contents/2016/09/aprender_programar_csharp_parte4_008-1.png" alt="aprender_programar_csharp_parte4_008" /></p>

<p><img src="/contents/2016/09/aprender_programar_csharp_parte4_009-1.png" alt="aprender_programar_csharp_parte4_009" /></p>

<p>Criado o formulário, precisaremos alterar o seu construtor para que ele possa receber valores do tipo Integer. Esses valores será o ID para utilizarmos o mesmo formulário para Edição e Inclusão. O código deverá ficar conforme abaixo:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="kt">int</span> <span class="n">Id</span><span class="p">;</span>
<span class="k">public</span> <span class="nf">Form2</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span> <span class="p">=</span> <span class="m">0</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="n">Id</span> <span class="p">=</span> <span class="n">id</span><span class="p">;</span>
    <span class="nf">InitializeComponent</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Agora vamos adicionar os campos necessários e atribuir nome para eles.</p>

<p><img src="/contents/2016/09/aprender_programar_csharp_parte4_010-1.png" alt="aprender_programar_csharp_parte4_010" /></p>

<p>Adicione 1 Botão, 3 labels, 2 Textbox e 1 DateTimePicker. Renomeie para btnSalvar, txtNome, txtDataNascimento e txtEmail respectivamente. Feito isso, vamos atribuir o código para o botão Salvar. Dê um duplo clique sobre o botão Salvar.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">btnSalvar_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">nome</span> <span class="p">=</span> <span class="n">txtNome</span><span class="p">.</span><span class="n">Text</span><span class="p">;</span>
    <span class="kt">var</span> <span class="n">dataNascimento</span> <span class="p">=</span> <span class="n">txtDataNascimento</span><span class="p">.</span><span class="n">Value</span><span class="p">;</span>
    <span class="kt">var</span> <span class="n">email</span> <span class="p">=</span> <span class="n">txtEmail</span><span class="p">.</span><span class="n">Text</span><span class="p">;</span>

    <span class="c1">// Retorna para a variavel a ConnectionString configurada no App.Config</span>
    <span class="kt">var</span> <span class="n">connectionString</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">Configuration</span><span class="p">.</span><span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">ConnectionStrings</span><span class="p">[</span><span class="s">"DbConnection"</span><span class="p">].</span><span class="n">ConnectionString</span><span class="p">;</span>

    <span class="c1">// Cria uma instancia de conexão com o banco de dados</span>
    <span class="k">using</span> <span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">SqlClient</span><span class="p">.</span><span class="n">SqlConnection</span> <span class="n">connection</span> <span class="p">=</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">SqlClient</span><span class="p">.</span><span class="nf">SqlConnection</span><span class="p">(</span><span class="n">connectionString</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="c1">// Abre a conexão</span>
        <span class="n">connection</span><span class="p">.</span><span class="nf">Open</span><span class="p">();</span>

        <span class="c1">// Cria uma instancia do command</span>
        <span class="k">using</span> <span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">SqlClient</span><span class="p">.</span><span class="n">SqlCommand</span> <span class="n">command</span> <span class="p">=</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">SqlClient</span><span class="p">.</span><span class="nf">SqlCommand</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="n">command</span><span class="p">.</span><span class="n">Connection</span> <span class="p">=</span> <span class="n">connection</span><span class="p">;</span>

            <span class="err">#</span><span class="n">region</span> <span class="n">Comando</span> <span class="n">SQL</span> <span class="n">que</span> <span class="n">ser</span><span class="err">á</span> <span class="n">executado</span>

            <span class="kt">var</span> <span class="n">_sqlQuery</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">;</span>

            <span class="c1">// Se foi passado o Id, é para editar</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Id</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">_sqlQuery</span> <span class="p">=</span> <span class="s">"UPDATE CLIENTES SET NOME = @NOME, EMAIL = @EMAIL, DATA_NASCIMENTO = @DATA_NASCIMENTO WHERE ID = @ID"</span><span class="p">;</span>

                <span class="n">command</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">_sqlQuery</span> <span class="p">=</span> <span class="s">"INSERT INTO CLIENTES(NOME, DATA_NASCIMENTO, EMAIL) VALUES(@NOME, @DATA_NASCIMENTO, @EMAIL)"</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">command</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"NOME"</span><span class="p">,</span> <span class="n">nome</span><span class="p">);</span>
            <span class="n">command</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"DATA_NASCIMENTO"</span><span class="p">,</span> <span class="n">dataNascimento</span><span class="p">);</span>
            <span class="n">command</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"EMAIL"</span><span class="p">,</span> <span class="n">email</span><span class="p">);</span>

            <span class="n">command</span><span class="p">.</span><span class="n">CommandText</span> <span class="p">=</span> <span class="n">_sqlQuery</span><span class="p">;</span>

            <span class="err">#</span><span class="n">endregion</span>

            <span class="c1">// Executa a query</span>
            <span class="n">command</span><span class="p">.</span><span class="nf">ExecuteNonQuery</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="c1">// Fecha conexão</span>
        <span class="n">connection</span><span class="p">.</span><span class="nf">Close</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="c1">// Fecha o formulario</span>
    <span class="k">this</span><span class="p">.</span><span class="nf">Close</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Agora vamos atribuir o código que será responsável por carregar os dados caso seja passado o Id do registro que desejamos editar. Voltando ao modo Designer, dê duplo clique no Form e atribua o código abaixo.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">Form2_Load</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">var</span> <span class="n">dataTable</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DataTable</span><span class="p">();</span>

    <span class="c1">// Retorna para a variavel a ConnectionString configurada no App.Config</span>
    <span class="kt">var</span> <span class="n">connectionString</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">Configuration</span><span class="p">.</span><span class="n">ConfigurationManager</span><span class="p">.</span><span class="n">ConnectionStrings</span><span class="p">[</span><span class="s">"DbConnection"</span><span class="p">].</span><span class="n">ConnectionString</span><span class="p">;</span>

    <span class="c1">// Cria uma instancia de conexão com o banco de dados</span>
    <span class="k">using</span> <span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">SqlClient</span><span class="p">.</span><span class="n">SqlConnection</span> <span class="n">connection</span> <span class="p">=</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">SqlClient</span><span class="p">.</span><span class="nf">SqlConnection</span><span class="p">(</span><span class="n">connectionString</span><span class="p">))</span>
    <span class="p">{</span>
        <span class="c1">// Abre a conexão</span>
        <span class="n">connection</span><span class="p">.</span><span class="nf">Open</span><span class="p">();</span>

        <span class="c1">// Cria uma instancia do command</span>
        <span class="k">using</span> <span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">SqlClient</span><span class="p">.</span><span class="n">SqlCommand</span> <span class="n">command</span> <span class="p">=</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">SqlClient</span><span class="p">.</span><span class="nf">SqlCommand</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="c1">// Comando SQL que será executado</span>
            <span class="kt">var</span> <span class="n">_sqlQuery</span> <span class="p">=</span> <span class="s">"SELECT * FROM CLIENTES WHERE ID = @ID"</span><span class="p">;</span>

            <span class="n">command</span><span class="p">.</span><span class="n">Connection</span> <span class="p">=</span> <span class="n">connection</span><span class="p">;</span>
            <span class="n">command</span><span class="p">.</span><span class="n">CommandText</span> <span class="p">=</span> <span class="n">_sqlQuery</span><span class="p">;</span>
            <span class="n">command</span><span class="p">.</span><span class="n">Parameters</span><span class="p">.</span><span class="nf">AddWithValue</span><span class="p">(</span><span class="s">"ID"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>

            <span class="c1">// Adiciona o resultado em um DataTable</span>
            <span class="k">using</span> <span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">SqlClient</span><span class="p">.</span><span class="n">SqlDataAdapter</span> <span class="n">adapter</span> <span class="p">=</span> <span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">SqlClient</span><span class="p">.</span><span class="nf">SqlDataAdapter</span><span class="p">(</span><span class="n">command</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">adapter</span><span class="p">.</span><span class="nf">Fill</span><span class="p">(</span><span class="n">dataTable</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// Fecha conexão</span>
        <span class="n">connection</span><span class="p">.</span><span class="nf">Close</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">dataTable</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">dataTable</span><span class="p">.</span><span class="n">Rows</span><span class="p">.</span><span class="n">Count</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">var</span> <span class="n">row</span> <span class="p">=</span> <span class="n">dataTable</span><span class="p">.</span><span class="n">Rows</span><span class="p">[</span><span class="m">0</span><span class="p">];</span>
        <span class="n">txtNome</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"NOME"</span><span class="p">].</span><span class="nf">ToString</span><span class="p">();</span>
        <span class="n">txtDataNascimento</span><span class="p">.</span><span class="n">Value</span> <span class="p">=</span> <span class="n">Convert</span><span class="p">.</span><span class="nf">ToDateTime</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">"DATA_NASCIMENTO"</span><span class="p">].</span><span class="nf">ToString</span><span class="p">());</span>
        <span class="n">txtEmail</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="n">row</span><span class="p">[</span><span class="s">"EMAIL"</span><span class="p">].</span><span class="nf">ToString</span><span class="p">();</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div>

<p>E agora para finalizar o formulário principal, vamos atribuir a codificação para chamar o formulário de edição/inclusão. Para codificar, primeiro execute um duplo clique sobre os botões.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">btnNovo_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Executa o formulario</span>
    <span class="kt">var</span> <span class="n">form2</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Form2</span><span class="p">();</span>
    <span class="c1">// Defini o titulo do formulário</span>
    <span class="n">form2</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="s">"Novo"</span><span class="p">;</span>
    <span class="c1">// Centraliza o form em relação ao form principal</span>
    <span class="n">form2</span><span class="p">.</span><span class="n">StartPosition</span> <span class="p">=</span> <span class="n">FormStartPosition</span><span class="p">.</span><span class="n">CenterParent</span><span class="p">;</span>
    <span class="c1">// Abre o form em modo Dialog</span>
    <span class="n">form2</span><span class="p">.</span><span class="nf">ShowDialog</span><span class="p">();</span>
    <span class="c1">// Invoca o botão de listar após o dialog ser fechado</span>
    <span class="nf">btnListar_Click</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">private</span> <span class="k">void</span> <span class="nf">btnEditar_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">gridClientes</span><span class="p">.</span><span class="n">SelectedRows</span><span class="p">.</span><span class="n">Count</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">id</span><span class="p">;</span>
        <span class="c1">// Pega o ID da primeira coluna da linha selecionada e realiza a conversão para Integer</span>
        <span class="kt">int</span><span class="p">.</span><span class="nf">TryParse</span><span class="p">(</span><span class="n">gridClientes</span><span class="p">.</span><span class="n">SelectedRows</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Cells</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Value</span><span class="p">.</span><span class="nf">ToString</span><span class="p">(),</span> <span class="k">out</span> <span class="n">id</span><span class="p">);</span>

        <span class="c1">// Executa o formulario passando o Id do registro que será editado</span>
        <span class="kt">var</span> <span class="n">form2</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Form2</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
        <span class="c1">// Defini o titulo do formulário</span>
        <span class="n">form2</span><span class="p">.</span><span class="n">Text</span> <span class="p">=</span> <span class="s">"Editar"</span><span class="p">;</span>
        <span class="c1">// Centraliza o form em relação ao form principal</span>
        <span class="n">form2</span><span class="p">.</span><span class="n">StartPosition</span> <span class="p">=</span> <span class="n">FormStartPosition</span><span class="p">.</span><span class="n">CenterParent</span><span class="p">;</span>
        <span class="c1">// Abre o form em modo Dialog</span>
        <span class="n">form2</span><span class="p">.</span><span class="nf">ShowDialog</span><span class="p">();</span>
        <span class="c1">// Invoca o botão de listar após o dialog ser fechado</span>
        <span class="nf">btnListar_Click</span><span class="p">(</span><span class="n">sender</span><span class="p">,</span> <span class="n">e</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Ao executar nossa aplicação, já podemos listar, excluir, incluir e editar os registros.</p>

<p><img src="/contents/2016/09/aprender_programar_csharp_parte4_011-1.png" alt="aprender_programar_csharp_parte4_011" /></p>

<p>Até aqui você aprendeu como criar formulários, efetuar a chamada de um formulário através de outros, efetuar a conexão com banco de dados SQL Server e efetuar transações efetuando as quarto operações Consulta, Inclusão, Exclusão e Edição. Procure exercitar atribuindo mais campos de dados ou até mesmo faça um novo projeto de cadastro mais completo.</p>

<p>Fonte do projeto: <a href="https://github.com/csharpbrasil/aprender_programar_csharp_parte4">Github</a>.</p>

<p>Até o próximo artigo e bom estudo!</p>

		
	</div>
	<div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/pt_BR/sdk.js#xfbml=1&version=v20.0" nonce="T10lHT3x"></script>
<div class="fb-comments" data-href="http://localhost:4000/aprender-a-programar-em-csharp-parte-4" data-width="" data-numposts="10"></div>


</article>


      </main>		
      <!-- Pagination links -->
      
	  </div>
    
    <!-- Footer -->
    <footer class="footer"><span>&copy; 2024 C# Brasil. Todos os direitos reservados | Versão: 1.0.0 </span></footer>
    <!-- Script -->
    <script src="/js/main.js"></script>	

	</div>
</body>
</html>
