<!DOCTYPE html>
<html>

<head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-T668JSDW');</script>
    <!-- End Google Tag Manager -->

	<!-- Meta -->
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Criando e consumindo Web API - Parte 1 | C# Brasil</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="Criando e consumindo Web API - Parte 1" />
<meta name="author" content="Raphael Cardoso" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Antes de iniciar o desenvolvimento de uma Web API é importante entender o que é, qual a sua finalidade e a forma como ela funciona." />
<meta property="og:description" content="Antes de iniciar o desenvolvimento de uma Web API é importante entender o que é, qual a sua finalidade e a forma como ela funciona." />
<link rel="canonical" href="http://localhost:4000/criando-e-consumindo-web-api-parte-1" />
<meta property="og:url" content="http://localhost:4000/criando-e-consumindo-web-api-parte-1" />
<meta property="og:site_name" content="C# Brasil" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2015-06-22T07:30:05-03:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Criando e consumindo Web API - Parte 1" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Raphael Cardoso","url":"http://www.csharpbrasil.com.br"},"dateModified":"2015-06-22T07:30:05-03:00","datePublished":"2015-06-22T07:30:05-03:00","description":"Antes de iniciar o desenvolvimento de uma Web API é importante entender o que é, qual a sua finalidade e a forma como ela funciona.","headline":"Criando e consumindo Web API - Parte 1","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/criando-e-consumindo-web-api-parte-1"},"url":"http://localhost:4000/criando-e-consumindo-web-api-parte-1"}</script>
<!-- End Jekyll SEO tag -->


	<!-- CSS & fonts -->
	<link rel="stylesheet" href="/css/main.css?1717257970198203784">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,800" rel="stylesheet" type="text/css">

    <link rel="shortcut icon" href="/images/favicon.png" />
</head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NS9JFVVY3Z"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-NS9JFVVY3Z');
</script>

<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T668JSDW"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

	<div id="wrap">
	  	
    <!-- Navigation -->
    <nav id="nav">
	<div id="nav-list">
		<a href="http://localhost:4000/">Página inicial</a>
		<a href="http://localhost:4000/sobre">Sobre o blog</a>
	</div>
</nav>

    
    <!-- Icon menu -->
	  <a id="nav-menu">
	  	<div id="menu"></div>
	  </a>
    <!-- Header -->
    <header id="header">
	<a href="http://localhost:4000/">
		<img src="/images/logo_csharpbrasil.png" class="logo" alt="C# Brasil">
	</a>
</header>

    <!-- Main content -->
	  <div id="container">
      <main>
        <article id="post-page">
	<h2>Criando e consumindo Web API - Parte 1</h2>		
	<time datetime="2015-06-22T07:30:05-03:00" class="by-line">
		
		22
		Junho
		  
		2015
	</time>
	<div class="content">

		<p>Antes de iniciar o desenvolvimento de uma Web API é importante entender o que é, qual a sua finalidade e a forma como ela funciona.</p>

<p>Para quem não conhece, uma Web API é um conjunto definido de mensagens de requisição e resposta HTTP, geralmente expressado nos formatos XML ou JSON.</p>

<p>Todos nós já tivemos contato de alguma forma com um serviço desse tipo, seja algum site que utilize no dia-a-dia, ou em um dos nossos aplicativos favoritos instalados no smartphone ou tablet. Um exemplo desses aplicativos são o Facebook, Twitter, Linkedin e até jogos utilizam-se de Web API. Então, se está planejando criar algum projeto novo, talvez esse seja um caminho a se analisar.</p>

<p>Para que você entenda melhor o funcionamento de uma Web API, vamos descrever de forma simples um cenário de funcionamento de Web API, como por exemplo a utilizada pelo seu aplicativo do Facebook. Considerando que ele está instalado em seu smartphone:</p>

<ul>
  <li>
    <p>Você informa seus dados de login</p>
  </li>
  <li>O aplicativo grava localmente os dados e envia-os a um servidor de autenticação para geração do Token</li>
  <li>Caso os dados sejam validos, é retornado o token para o aplicativo</li>
  <li>Para realizar a consulta dos post de sua linha, o aplicativo requisita as informações ao servidor utilizando o token para validação</li>
</ul>

<p>Veja abaixo de forma ilustrada como funciona basicamente a requisição, a autenticação e retorno dos dados para o usuário.</p>

<p><img src="/contents/2015/06/autenticacao_web_api.png" alt="Autenticaçãoo Web API" /></p>

<p>Para conhecer mais sobre o detalhes do funcionamento do Web API, indico o <a href="http://israelaece.com/post/e-Book-Introducao-ao-ASPNET-Web-API.aspx">e-Book do Israel Aece</a> que alem de gratuito possui um excelente conteúdo para aprendizado.</p>

<p>Iniciaremos então a criação de um novo projeto, para isso, indico o uso do <a href="https://www.visualstudio.com/">Visual Studio Community 2013</a> que alem de completo também é gratuito.</p>

<p>Primeiramente, abra o Visual Studio e clique nome menu <em>File &gt; New &gt; Project</em> e crie um novo projeto web utilizando o template <strong>ASP.NET Web Application</strong> e utilizando o <strong>.NET Framework 4.5</strong>. Defina um nome e caminho para ele. No meu caso, simplesmente se chamara <strong>ProjetoAspNetWebApi</strong>.</p>

<p><img src="/contents/2015/06/criando_e_consumindo_webapi_001.png" alt="criando_e_consumindo_webapi_001" /></p>

<p>Após clicar em OK para confirmar, uma nova janela é exibida para selecionar detalhes de nosso ASP.NET Web Application. Nele é possível definirmos templates do tipo WebForms, MVC, Web API, Single Page Application, Azure Mobile Service e Empty. No nosso caso selecionaremos o template Empty para que possamos adicionar somente as bibliotecas e estrutura que são realmente necessários para nosso projeto.</p>

<p><img src="/contents/2015/06/criando_e_consumindo_webapi_002.png" alt="criando_e_consumindo_webapi_002" /></p>

<p>Feito isso, agora vamos a lista de bibliotecas necessárias:</p>

<ul>
  <li><strong><a href="https://www.nuget.org/packages/DotNetZip/">DotNetZip</a>:</strong> Biblioteca de compressão;</li>
  <li><strong><a href="https://www.nuget.org/packages/Microsoft.AspNet.Cors/">Microsoft.AspNet.Cors</a>:</strong> Biblioteca que permitir Cross-Origin Resource Sharing (CORS) em ASP.NET;</li>
  <li><strong><a href="https://www.nuget.org/packages/Microsoft.AspNet.WebApi.Client/">Microsoft.AspNet.WebApi.Client</a>:</strong> Biblioteca que adiciona suporte para formatação de conteúdo para System.Net.Http incluindo suporte para JSON e XML;</li>
  <li><strong><a href="https://www.nuget.org/packages/Microsoft.AspNet.WebApi.Core/">Microsoft.AspNet.WebApi.Core</a>:</strong> Biblioteca que contém o core para ASP.NET API Web;</li>
  <li><strong><a href="https://www.nuget.org/packages/Microsoft.AspNet.WebApi.Owin/">Microsoft.AspNet.WebApi.Owin</a>:</strong> Biblioteca que permite a hospedagem de ASP.NET Web API dentro de um servidor Owin e fornece acesso a recursos adicionais.</li>
  <li><strong><a href="https://www.nuget.org/packages/Microsoft.Bcl/">Microsoft.Bcl</a>:</strong> Biblioteca com componentes adicionais;</li>
  <li><strong><a href="https://www.nuget.org/packages/Microsoft.Bcl.Build/">Microsoft.Bcl.Build</a>:</strong> Biblioteca com componentes adicionais;</li>
  <li><strong><a href="https://www.nuget.org/packages/Microsoft.Bcl.Compression/">Microsoft.Bcl.Compression</a>:</strong> Biblioteca que permite a projetos voltados diretamente para Windows Phone Silverligth 8 ou usando bibliotecas portaveis usem as classes ZipArchive, GZipStream e DeflateStream;</li>
  <li><strong><a href="https://www.nuget.org/packages/Microsoft.Net.Http">Microsoft.Net.Http</a>:</strong> Biblioteca que inclui HttpClient para envio de pedidos através de HTTP, bem como HttpRequestMessage e HttpResponseMessage para o processamento de mensagens HTTP;</li>
  <li><strong><a href="https://www.nuget.org/packages/Microsoft.Owin/">Microsoft.Owin</a>:</strong> Biblioteca que fornece um conjunto de componentes para auxiliar e simplificar a criação de componentes Owin;</li>
  <li><strong><a href="https://www.nuget.org/packages/Microsoft.Owin.Cors/">Microsoft.Owin.Cors</a>:</strong> Biblioteca que contém os componentes para habilitar o Cross-Origin Resource Sharing (CORS);</li>
  <li><strong><a href="https://www.nuget.org/packages/Microsoft.Owin.Host.SystemWeb/">Microsoft.Owin.Host.SystemWeb</a>:</strong> Biblioteca do servidor Owin que permite que aplicativos baseados em Owin sejam executados no IIS usando o pipeline de solicitação do ASP.NET;</li>
  <li><strong><a href="https://www.nuget.org/packages/Microsoft.Owin.Security/">Microsoft.Owin.Security</a>:</strong> Biblioteca que contem tipos comuns relacionados a autenticação;</li>
  <li><strong><a href="https://www.nuget.org/packages/Microsoft.Owin.Security.OAuth">Microsoft.Owin.Security.OAuth</a>:</strong> Biblioteca que contem tipos comuns relacionados a autenticação OAuth;</li>
  <li><strong><a href="https://www.nuget.org/packages/newtonsoft.json/">Newtonsoft.Json</a>:</strong> Biblioteca JSON de alta performance;</li>
  <li><strong><a href="https://www.nuget.org/packages/Owin/">Owin</a>:</strong> Biblioteca de interface de inicialização;</li>
  <li><strong><a href="https://www.nuget.org/packages/Strathweb.CacheOutput.WebApi2/">Strathweb.CacheOutput.WebApi2</a>:</strong> Biblioteca que cuida do cache do lado do servidor semelhante ao OutputCache do MVC;</li>
  <li><strong><a href="https://www.nuget.org/packages/Unity/">Unity</a>:</strong> Biblioteca de injeção de dependências.</li>
</ul>

<p>Agora que você conheceu um pouco de cada uma das biliotecas, vamos iniciar a instalação em nosso projeto. Será necessário utilizar o Nuget no Visual Studio para inclusão das bibliotecas.</p>

<p>Existem 2 formar de incluir as bibliotecas pelo Nuget. Uma é usando o <strong>Package Manager Console</strong> e a outra é o <strong>Manage Nuget Package for Solution</strong>. Eu prefiro o segundo, porem como forma de aprendizado e para agilizar, vou fazer da primeira forma pois assim passo as linhas de comando para incluir as biblioteca.</p>

<p><img src="/contents/2015/06/criando_e_consumindo_webapi_003.png" alt="criando_e_consumindo_webapi_003" /></p>

<p>Abra o <strong>Package Manager Console</strong> e digite as linhas abaixo ou simplesmente copie e cole.</p>

<p>[code=’powershell’] Install-Package DotNetZip Install-Package Microsoft.AspNet.Cors Install-Package Microsoft.AspNet.WebApi.Client Install-Package Microsoft.AspNet.WebApi.Core Install-Package Microsoft.AspNet.WebApi.Owin Install-Package Microsoft.Bcl Install-Package Microsoft.Bcl.Build Install-Package Microsoft.Bcl.Compression Install-Package Microsoft.Net.Http Install-Package Microsoft.Owin Install-Package Microsoft.Owin.Cors Install-Package Microsoft.Owin.Host.SystemWeb Install-Package Microsoft.Owin.Security Install-Package Microsoft.Owin.Security.OAuth Install-Package Newtonsoft.Json Install-Package Owin Install-Package Strathweb.CacheOutput.WebApi2 Install-Package Unity ```</p>

<p>Após copiar as linhas acima e colocar teremos todas as bibliotecas e suas dependências adicionas.</p>

<p><img src="/contents/2015/06/criando_e_consumindo_webapi_004.png" alt="criando_e_consumindo_webapi_004" /></p>

<p>Para que possamos começar a utilizar nosso ASP.NEt Web API e começar implementar as rotas, é preciso criar a classe de Startup que será responsável por inicializar as configurações da API. Na raiz do nosso projeto, crie uma nova classe chamada <strong>Startup.cs</strong>. Para isso clique com o botão direto em cima do Projeto e clique em <em>Add &gt; Class</em>.</p>

<p><img src="/contents/2015/06/criando_e_consumindo_webapi_005.png" alt="criando_e_consumindo_webapi_005" /></p>

<p>A classe criada terá o código abaixo:</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">Newtonsoft.Json</span><span class="p">;</span> <span class="k">using</span> <span class="nn">Newtonsoft.Json.Serialization</span><span class="p">;</span> <span class="k">using</span> <span class="nn">Owin</span><span class="p">;</span> <span class="k">using</span> <span class="nn">System.Web.Http</span><span class="p">;</span> <span class="err">```</span>
<span class="err">```</span><span class="n">csharp</span> 
<span class="k">public</span> <span class="k">class</span> <span class="nc">Startup</span> <span class="p">{</span> <span class="k">public</span> <span class="k">void</span> <span class="nf">Configuration</span><span class="p">(</span><span class="n">IAppBuilder</span> <span class="n">app</span><span class="p">)</span> <span class="p">{</span> <span class="n">HttpConfiguration</span> <span class="n">config</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HttpConfiguration</span><span class="p">();</span> <span class="kt">var</span> <span class="n">formatters</span> <span class="p">=</span> <span class="n">config</span><span class="p">.</span><span class="n">Formatters</span><span class="p">;</span> <span class="n">formatters</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">formatters</span><span class="p">.</span><span class="n">XmlFormatter</span><span class="p">);</span> <span class="kt">var</span> <span class="n">jsonSettings</span> <span class="p">=</span> <span class="n">formatters</span><span class="p">.</span><span class="n">JsonFormatter</span><span class="p">.</span><span class="n">SerializerSettings</span><span class="p">;</span> <span class="n">jsonSettings</span><span class="p">.</span><span class="n">Formatting</span> <span class="p">=</span> <span class="n">Formatting</span><span class="p">.</span><span class="n">Indented</span><span class="p">;</span> <span class="n">jsonSettings</span><span class="p">.</span><span class="n">ContractResolver</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CamelCasePropertyNamesContractResolver</span><span class="p">();</span> <span class="n">formatters</span><span class="p">.</span><span class="n">JsonFormatter</span><span class="p">.</span><span class="n">SerializerSettings</span><span class="p">.</span><span class="n">PreserveReferencesHandling</span> <span class="p">=</span> <span class="n">Newtonsoft</span><span class="p">.</span><span class="n">Json</span><span class="p">.</span><span class="n">PreserveReferencesHandling</span><span class="p">.</span><span class="n">Objects</span><span class="p">;</span> <span class="n">config</span><span class="p">.</span><span class="nf">MapHttpAttributeRoutes</span><span class="p">();</span> <span class="n">config</span><span class="p">.</span><span class="n">Routes</span><span class="p">.</span><span class="nf">MapHttpRoute</span><span class="p">(</span> <span class="n">name</span><span class="p">:</span> <span class="s">"DefaultRoute"</span><span class="p">,</span> <span class="n">routeTemplate</span><span class="p">:</span> <span class="s">"api/{controller}/{id}"</span><span class="p">,</span> <span class="n">defaults</span><span class="p">:</span> <span class="k">new</span> <span class="p">{</span> <span class="n">id</span> <span class="p">=</span> <span class="n">RouteParameter</span><span class="p">.</span><span class="n">Optional</span> <span class="p">}</span> <span class="p">);</span> <span class="n">app</span><span class="p">.</span><span class="nf">UseCors</span><span class="p">(</span><span class="n">Microsoft</span><span class="p">.</span><span class="n">Owin</span><span class="p">.</span><span class="n">Cors</span><span class="p">.</span><span class="n">CorsOptions</span><span class="p">.</span><span class="n">AllowAll</span><span class="p">);</span> <span class="n">app</span><span class="p">.</span><span class="nf">UseWebApi</span><span class="p">(</span><span class="n">config</span><span class="p">);</span> <span class="p">}</span> <span class="p">}</span> <span class="err">```</span>

<span class="n">O</span> <span class="n">que</span> <span class="n">esse</span> <span class="n">c</span><span class="err">ó</span><span class="n">digo</span> <span class="n">faz</span> <span class="err">é</span><span class="p">,</span> <span class="n">remover</span> <span class="n">o</span> <span class="n">formato</span> <span class="n">XML</span> <span class="n">e</span> <span class="n">adicionar</span> <span class="n">o</span> <span class="n">formato</span> <span class="n">JSON</span> <span class="n">alem</span> <span class="n">de</span> <span class="n">definir</span> <span class="n">nossa</span> <span class="n">mapa</span> <span class="n">da</span> <span class="n">rota</span><span class="p">.</span>

<span class="n">Crie</span> <span class="n">uma</span> <span class="n">nova</span> <span class="n">pasta</span> <span class="n">na</span> <span class="n">raiz</span> <span class="k">do</span> <span class="n">projeto</span> <span class="n">com</span> <span class="n">o</span> <span class="n">nome</span> <span class="n">de</span> <span class="p">**</span><span class="n">Controllers</span><span class="p">**.</span> <span class="err">É</span> <span class="n">nessa</span> <span class="n">pasta</span> <span class="n">que</span> <span class="n">adicionaremos</span> <span class="n">nossos</span> <span class="n">controllers</span><span class="p">.</span>

<span class="n">Clique</span> <span class="n">com</span> <span class="n">o</span> <span class="n">bot</span><span class="err">ã</span><span class="n">o</span> <span class="n">direito</span> <span class="n">em</span> <span class="n">cima</span> <span class="n">da</span> <span class="n">pasta</span> <span class="n">criada</span> <span class="n">e</span> <span class="n">clique</span> <span class="n">em</span> <span class="n">_Add</span> <span class="p">&gt;</span> <span class="n">Controller_</span><span class="p">.</span>

<span class="p">![</span><span class="n">criando_e_consumindo_webapi_006</span><span class="p">](/</span><span class="n">contents</span><span class="p">/</span><span class="m">2015</span><span class="p">/</span><span class="m">06</span><span class="p">/</span><span class="n">criando_e_consumindo_webapi_006</span><span class="p">.</span><span class="n">png</span><span class="p">)</span>

<span class="n">Na</span> <span class="n">nova</span> <span class="n">janela</span><span class="p">,</span> <span class="n">escolha</span> <span class="n">o</span> <span class="n">Scaffold</span> <span class="p">**</span><span class="n">Web</span> <span class="n">API</span> <span class="m">2</span> <span class="n">Controller</span> <span class="p">-</span> <span class="n">Empty</span><span class="p">**.</span>

<span class="p">![</span><span class="n">criando_e_consumindo_webapi_007</span><span class="p">](/</span><span class="n">contents</span><span class="p">/</span><span class="m">2015</span><span class="p">/</span><span class="m">06</span><span class="p">/</span><span class="n">criando_e_consumindo_webapi_007</span><span class="p">.</span><span class="n">png</span><span class="p">)</span>

<span class="n">Defina</span> <span class="n">um</span> <span class="n">nome</span> <span class="n">para</span> <span class="n">o</span> <span class="n">seu</span> <span class="n">controller</span><span class="p">.</span> <span class="n">Sugiro</span> <span class="n">colocar</span> <span class="n">o</span> <span class="n">nome</span> <span class="n">como</span> <span class="n">_DefaultController_</span><span class="p">.</span>

<span class="p">![</span><span class="n">criando_e_consumindo_webapi_008</span><span class="p">](/</span><span class="n">contents</span><span class="p">/</span><span class="m">2015</span><span class="p">/</span><span class="m">06</span><span class="p">/</span><span class="n">criando_e_consumindo_webapi_008</span><span class="p">.</span><span class="n">png</span><span class="p">)</span>

<span class="n">Com</span> <span class="n">o</span> <span class="n">controller</span> <span class="n">criado</span><span class="p">,</span> <span class="n">criaremos</span> <span class="n">ent</span><span class="err">ã</span><span class="n">o</span> <span class="n">alguns</span> <span class="n">m</span><span class="err">é</span><span class="n">todos</span> <span class="n">para</span> <span class="n">nosso</span> <span class="n">controller</span> <span class="n">e</span> <span class="n">definiremos</span> <span class="k">as</span> <span class="n">rotas</span><span class="p">.</span>

<span class="n">Defina</span> <span class="n">o</span> <span class="n">RoutePrefix</span> <span class="n">para</span> <span class="n">o</span> <span class="n">Controller</span><span class="p">,</span> <span class="n">ficando</span> <span class="n">conforme</span> <span class="n">c</span><span class="err">ó</span><span class="n">digo</span> <span class="n">abaixo</span><span class="p">.</span>

<span class="err">```</span><span class="n">csharp</span> 
<span class="p">[</span><span class="nf">RoutePrefix</span><span class="p">(</span><span class="s">"api/meuprojeto"</span><span class="p">)]</span> <span class="k">public</span> <span class="k">class</span> <span class="nc">DefaultController</span> <span class="p">:</span> <span class="n">ApiController</span> <span class="p">{</span> <span class="p">}</span> <span class="err">```</span>

<span class="n">O</span> <span class="n">exemplo</span> <span class="n">acima</span> <span class="n">estabelecemos</span> <span class="n">que</span> <span class="n">quando</span> <span class="k">for</span> <span class="n">chamado</span> <span class="n">a</span> <span class="n">url</span> <span class="n">com</span> <span class="n">o</span> <span class="n">prefixo</span> <span class="p">**</span><span class="n">api</span><span class="p">/</span><span class="n">meuprojeto</span><span class="p">**,</span> <span class="n">ser</span><span class="err">á</span> <span class="n">direcionado</span> <span class="n">para</span> <span class="n">esse</span> <span class="n">controller</span> <span class="n">que</span> <span class="n">acabamos</span> <span class="n">de</span> <span class="n">criar</span><span class="p">.</span>

<span class="n">Agora</span> <span class="n">crie</span> <span class="n">o</span> <span class="n">m</span><span class="err">é</span><span class="n">todo</span> <span class="n">abaixo</span> <span class="n">dentro</span> <span class="k">do</span> <span class="n">controller</span><span class="p">.</span>

<span class="err">```</span><span class="n">csharp</span> 
<span class="p">[</span><span class="nf">RoutePrefix</span><span class="p">(</span><span class="s">"api/meuprojeto"</span><span class="p">)]</span> <span class="k">public</span> <span class="k">class</span> <span class="nc">DefaultController</span> <span class="p">:</span> <span class="n">ApiController</span> <span class="p">{</span> <span class="p">[</span><span class="n">HttpGet</span><span class="p">]</span> <span class="p">[</span><span class="nf">Route</span><span class="p">(</span><span class="s">"datahora/consulta"</span><span class="p">)]</span> <span class="k">public</span> <span class="n">HttpResponseMessage</span> <span class="nf">GetDataHoraServidor</span><span class="p">()</span> <span class="p">{</span> <span class="k">try</span> <span class="p">{</span> <span class="kt">var</span> <span class="n">dataHora</span> <span class="p">=</span> <span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">.</span><span class="nf">ToString</span><span class="p">(</span><span class="s">"dd/MM/yyyy HH:mm:ss"</span><span class="p">);</span> <span class="k">return</span> <span class="n">Request</span><span class="p">.</span><span class="nf">CreateResponse</span><span class="p">(</span><span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">OK</span><span class="p">,</span> <span class="n">dataHora</span><span class="p">);</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Request</span><span class="p">.</span><span class="nf">CreateResponse</span><span class="p">(</span><span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">BadRequest</span><span class="p">,</span> <span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="err">```</span>

<span class="n">Como</span> <span class="n">pode</span> <span class="n">ver</span> <span class="n">no</span> <span class="n">exemplo</span><span class="p">,</span> <span class="n">criamos</span> <span class="n">um</span> <span class="n">m</span><span class="err">é</span><span class="n">todo</span> <span class="k">do</span> <span class="n">tipo</span> <span class="n">_HttpGet_</span> <span class="n">com</span> <span class="n">a</span> <span class="n">rota</span> <span class="n">_datahora</span><span class="p">/</span><span class="n">consulta_</span> <span class="n">que</span> <span class="n">no</span> <span class="n">final</span><span class="p">,</span> <span class="n">quando</span> <span class="n">formos</span> <span class="n">chamar</span><span class="p">-</span><span class="n">la</span> <span class="n">no</span> <span class="n">browser</span><span class="p">,</span> <span class="n">chamaremos</span> <span class="n">pela</span> <span class="n">url</span> <span class="n">_http</span><span class="p">:</span><span class="c1">//{servidor}/api/meuprojeto/datahora/consulta_.</span>

<span class="p">![</span><span class="n">criando_e_consumindo_webapi_009</span><span class="p">](/</span><span class="n">contents</span><span class="p">/</span><span class="m">2015</span><span class="p">/</span><span class="m">06</span><span class="p">/</span><span class="n">criando_e_consumindo_webapi_009</span><span class="p">.</span><span class="n">png</span><span class="p">)</span>

<span class="n">Podemos</span> <span class="n">tamb</span><span class="err">é</span><span class="n">m</span> <span class="n">criar</span> <span class="n">um</span> <span class="n">m</span><span class="err">é</span><span class="n">todo</span> <span class="n">utilizando</span><span class="p">-</span><span class="n">se</span> <span class="k">do</span> <span class="n">uso</span> <span class="n">de</span> <span class="n">par</span><span class="err">â</span><span class="n">metros</span> <span class="n">para</span> <span class="n">consulta</span><span class="p">.</span>

<span class="err">```</span><span class="n">csharp</span> 
<span class="p">[</span><span class="n">HttpGet</span><span class="p">]</span> <span class="p">[</span><span class="nf">Route</span><span class="p">(</span><span class="s">"consulta/cliente/{id:int}"</span><span class="p">)]</span> <span class="k">public</span> <span class="n">HttpResponseMessage</span> <span class="nf">GetClientePorId</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span> <span class="k">try</span> <span class="p">{</span> <span class="kt">var</span> <span class="n">clientes</span> <span class="p">=</span> <span class="k">new</span><span class="p">[]</span> <span class="p">{</span> <span class="k">new</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">1</span><span class="p">,</span> <span class="n">Nome</span> <span class="p">=</span> <span class="s">"Pedro"</span><span class="p">,</span> <span class="n">DataNascimento</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1954</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">1</span><span class="p">)</span> <span class="p">},</span> <span class="k">new</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">2</span><span class="p">,</span> <span class="n">Nome</span> <span class="p">=</span> <span class="s">"Paulo"</span><span class="p">,</span> <span class="n">DataNascimento</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1944</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">12</span><span class="p">)</span> <span class="p">},</span> <span class="k">new</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">3</span><span class="p">,</span> <span class="n">Nome</span> <span class="p">=</span> <span class="s">"Fernando"</span><span class="p">,</span> <span class="n">DataNascimento</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1963</span><span class="p">,</span> <span class="m">5</span><span class="p">,</span> <span class="m">9</span><span class="p">)</span> <span class="p">},</span> <span class="k">new</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">4</span><span class="p">,</span> <span class="n">Nome</span> <span class="p">=</span> <span class="s">"Maria"</span><span class="p">,</span> <span class="n">DataNascimento</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1984</span><span class="p">,</span> <span class="m">4</span><span class="p">,</span> <span class="m">30</span><span class="p">)</span> <span class="p">},</span> <span class="k">new</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">5</span><span class="p">,</span> <span class="n">Nome</span> <span class="p">=</span> <span class="s">"João"</span><span class="p">,</span> <span class="n">DataNascimento</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1990</span><span class="p">,</span> <span class="m">3</span><span class="p">,</span> <span class="m">14</span><span class="p">)</span> <span class="p">},</span> <span class="k">new</span> <span class="p">{</span> <span class="n">Id</span> <span class="p">=</span> <span class="m">6</span><span class="p">,</span> <span class="n">Nome</span> <span class="p">=</span> <span class="s">"Joana"</span><span class="p">,</span> <span class="n">DataNascimento</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DateTime</span><span class="p">(</span><span class="m">1974</span><span class="p">,</span> <span class="m">6</span><span class="p">,</span> <span class="m">19</span><span class="p">)</span> <span class="p">}</span> <span class="p">};</span> <span class="kt">var</span> <span class="n">cliente</span> <span class="p">=</span> <span class="n">clientes</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Id</span> <span class="p">==</span> <span class="n">id</span><span class="p">).</span><span class="nf">FirstOrDefault</span><span class="p">();</span> <span class="k">if</span> <span class="p">(</span><span class="n">cliente</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="s">"Cliente não encontrado"</span><span class="p">);</span> <span class="k">return</span> <span class="n">Request</span><span class="p">.</span><span class="nf">CreateResponse</span><span class="p">(</span><span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">OK</span><span class="p">,</span> <span class="n">cliente</span><span class="p">);</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Request</span><span class="p">.</span><span class="nf">CreateResponse</span><span class="p">(</span><span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">BadRequest</span><span class="p">,</span> <span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span> <span class="p">}</span> <span class="p">}</span> <span class="err">```</span>

<span class="n">No</span> <span class="n">exemplo</span> <span class="n">criamos</span> <span class="n">um</span> <span class="n">novo</span> <span class="n">m</span><span class="err">é</span><span class="n">todo</span> <span class="n">que</span> <span class="n">recebe</span> <span class="n">um</span> <span class="n">par</span><span class="err">â</span><span class="n">metro</span> <span class="k">do</span> <span class="n">tipo</span> <span class="n">_int_</span><span class="p">,</span> <span class="n">que</span> <span class="err">é</span> <span class="k">do</span> <span class="n">tipo</span> <span class="n">_HttpGet_</span> <span class="n">que</span> <span class="n">possui</span> <span class="n">a</span> <span class="n">rota</span> <span class="n">_consulta</span><span class="p">/</span><span class="n">cliente</span><span class="p">/{</span><span class="n">id</span><span class="p">:</span><span class="kt">int</span><span class="p">}</span><span class="n">_</span><span class="p">.</span> <span class="n">Quando</span> <span class="k">for</span> <span class="n">chamar</span> <span class="n">no</span> <span class="n">browser</span> <span class="n">essa</span> <span class="n">url</span><span class="p">,</span> <span class="n">chamaremos</span> <span class="n">pela</span> <span class="n">url</span> <span class="n">_http</span><span class="p">:</span><span class="c1">//{servidor}/api/meuprojeto/consulta/cliente/{id}_, onde {id} é o id que queremos consultar.</span>

<span class="p">![</span><span class="n">criando_e_consumindo_webapi_010</span><span class="p">](/</span><span class="n">contents</span><span class="p">/</span><span class="m">2015</span><span class="p">/</span><span class="m">06</span><span class="p">/</span><span class="n">criando_e_consumindo_webapi_010</span><span class="p">.</span><span class="n">png</span><span class="p">)</span>

<span class="n">Ainda</span> <span class="n">no</span> <span class="n">exemplo</span><span class="p">,</span> <span class="n">caso</span> <span class="n">passemos</span> <span class="n">um</span> <span class="n">id</span> <span class="n">que</span> <span class="n">n</span><span class="err">ã</span><span class="n">o</span> <span class="n">existe</span><span class="p">,</span> <span class="n">iremos</span> <span class="n">acionar</span> <span class="n">um</span> <span class="n">Exception</span> <span class="n">que</span> <span class="n">por</span> <span class="n">sua</span> <span class="n">vez</span> <span class="n">cair</span><span class="err">á</span> <span class="n">na</span> <span class="n">tratativa</span> <span class="k">do</span> <span class="n">_try</span> <span class="n">catch_</span> <span class="n">e</span> <span class="n">retornar</span><span class="err">á</span> <span class="n">um</span> <span class="n">_BadRequest_</span><span class="p">.</span>

<span class="p">![</span><span class="n">criando_e_consumindo_webapi_011</span><span class="p">](/</span><span class="n">contents</span><span class="p">/</span><span class="m">2015</span><span class="p">/</span><span class="m">06</span><span class="p">/</span><span class="n">criando_e_consumindo_webapi_0111</span><span class="p">.</span><span class="n">png</span><span class="p">)</span>

<span class="n">At</span><span class="err">é</span> <span class="n">aqui</span> <span class="n">fizemos</span> <span class="n">alguns</span> <span class="n">exemplos</span> <span class="n">de</span> <span class="n">_HttpGet_</span><span class="p">,</span> <span class="n">agora</span> <span class="n">vou</span> <span class="n">exemplificar</span> <span class="n">como</span> <span class="n">fazer</span> <span class="n">uso</span> <span class="k">do</span> <span class="n">_HttpPost_</span> <span class="n">para</span> <span class="n">submeter</span> <span class="n">objetivos</span> <span class="n">mais</span> <span class="n">complexos</span><span class="p">.</span>

<span class="n">Primeiro</span> <span class="n">criaremos</span> <span class="n">a</span> <span class="n">classe</span> <span class="n">_Cliente_</span><span class="p">.</span>

<span class="err">```</span><span class="n">csharp</span> 
<span class="k">public</span> <span class="k">class</span> <span class="nc">Cliente</span> <span class="p">{</span> <span class="k">public</span> <span class="kt">string</span> <span class="n">Nome</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span> <span class="err">```</span>

<span class="n">E</span> <span class="n">agora</span> <span class="n">criaremos</span> <span class="n">o</span> <span class="n">nosso</span> <span class="n">m</span><span class="err">é</span><span class="n">todo</span> <span class="n">de</span> <span class="n">_HttpPost_</span><span class="p">.</span>

<span class="err">```</span><span class="n">csharp</span> 
<span class="p">[</span><span class="n">HttpPost</span><span class="p">]</span> <span class="p">[</span><span class="nf">Route</span><span class="p">(</span><span class="s">"cadastrar"</span><span class="p">)]</span> <span class="k">public</span> <span class="n">HttpResponseMessage</span> <span class="nf">PostCadastro</span><span class="p">(</span><span class="n">Cliente</span> <span class="n">cliente</span><span class="p">)</span> <span class="p">{</span> <span class="k">try</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Request</span><span class="p">.</span><span class="nf">CreateResponse</span><span class="p">(</span><span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">OK</span><span class="p">,</span> <span class="s">"Cadastro do usuário "</span> <span class="p">+</span> <span class="n">cliente</span><span class="p">.</span><span class="n">Nome</span> <span class="p">+</span> <span class="s">" realizado."</span><span class="p">);</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="n">Request</span><span class="p">.</span><span class="nf">CreateResponse</span><span class="p">(</span><span class="n">HttpStatusCode</span><span class="p">.</span><span class="n">BadRequest</span><span class="p">,</span> <span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">);</span> <span class="p">}</span> <span class="p">}</span> <span class="err">```</span>

<span class="n">No</span> <span class="n">exemplo</span> <span class="n">criamos</span> <span class="n">um</span> <span class="n">novo</span> <span class="n">m</span><span class="err">é</span><span class="n">todo</span> <span class="n">que</span> <span class="n">n</span><span class="err">ã</span><span class="n">o</span> <span class="n">recebe</span> <span class="n">nenhum</span> <span class="n">par</span><span class="err">â</span><span class="n">metro</span> <span class="n">pela</span> <span class="n">url</span> <span class="n">como</span> <span class="n">ocorre</span> <span class="n">com</span> <span class="n">os</span> <span class="n">HttpGet</span><span class="p">.</span> <span class="n">Nesse</span> <span class="n">caso</span><span class="p">,</span> <span class="n">os</span> <span class="n">dados</span> <span class="n">precisam</span> <span class="n">ser</span> <span class="n">submetidos</span> <span class="n">para</span> <span class="n">a</span> <span class="n">url</span> <span class="n">e</span> <span class="n">nesse</span> <span class="n">caso</span> <span class="n">vou</span> <span class="n">testar</span> <span class="n">usando</span> <span class="n">o</span> <span class="n">aplicativo</span> <span class="p">[</span><span class="n">Postman</span><span class="p">](</span><span class="n">https</span><span class="p">:</span><span class="c1">//chrome.google.com/webstore/detail/postman/fhbjgbiflinjbdggehcddcbncdddomop) para o Google Chrome.</span>

<span class="n">Para</span> <span class="n">testar</span><span class="p">,</span> <span class="n">abra</span> <span class="n">o</span> <span class="n">Postman</span> <span class="n">e</span> <span class="n">selecione</span> <span class="n">o</span> <span class="n">tipo</span> <span class="n">de</span> <span class="n">requisi</span><span class="err">çã</span><span class="n">o</span><span class="p">.</span> <span class="n">No</span> <span class="n">caso</span> <span class="n">usaremos</span> <span class="n">o</span> <span class="n">_Post_</span><span class="p">.</span> <span class="n">Informe</span> <span class="n">a</span> <span class="n">url</span><span class="p">,</span> <span class="n">selecione</span> <span class="n">o</span> <span class="n">formato</span> <span class="n">_raw_</span> <span class="n">e</span> <span class="n">o</span> <span class="n">tipo</span> <span class="n">de</span> <span class="n">dados</span> <span class="n">a</span> <span class="n">ser</span> <span class="n">submetido</span> <span class="n">como</span> <span class="nf">_JSON</span> <span class="p">(</span><span class="n">application</span><span class="p">/</span><span class="n">json</span><span class="p">)</span><span class="n">_</span> <span class="n">e</span> <span class="n">informe</span> <span class="n">o</span> <span class="n">JSON</span><span class="p">.</span>

<span class="p">[</span><span class="n">code</span><span class="p">=</span><span class="err">'</span><span class="n">javascript</span><span class="err">'</span><span class="p">]</span> <span class="p">{</span> <span class="s">"Nome"</span><span class="p">:</span><span class="s">"Raphael Cardoso"</span> <span class="p">}</span>
</code></pre></div></div>
<p><img src="/contents/2015/06/criando_e_consumindo_webapi_012.png" alt="criando_e_consumindo_webapi_012" /></p>

<p>Você aprendeu de forma simples a criação de uma Web API. Poderá tranquilamente explorar o que foi passado criando novos métodos que recebam parametros diferentes ou até mesmo que utilize de objetos mais complexos ao realizar um HttpPost.</p>

<p>Na próxima parte, veremos como utilizar de conexão com banco de dados em nossa Web API e possibilitar realização de CRUD (Create, Read, Update, Delete).</p>

<p>Em caso de dúvida, utilize os comentários ou publique sua dúvida no fórum.</p>

<p>Fonte do projeto: <a href="https://github.com/csharpbrasil/AspNetWebApi">Github</a>.</p>

<p>Abraço e até a próxima!</p>

		
	</div>
	<div id="fb-root"></div>
<script async defer crossorigin="anonymous" src="https://connect.facebook.net/pt_BR/sdk.js#xfbml=1&version=v20.0" nonce="T10lHT3x"></script>
<div class="fb-comments" data-href="http://localhost:4000/criando-e-consumindo-web-api-parte-1" data-width="" data-numposts="10"></div>


</article>


      </main>		
      <!-- Pagination links -->
      
	  </div>
    
    <!-- Footer -->
    <footer class="footer"><span>&copy; 2024 C# Brasil. Todos os direitos reservados | Versão: 1.0.0 </span></footer>
    <!-- Script -->
    <script src="/js/main.js"></script>	

	</div>
</body>
</html>
