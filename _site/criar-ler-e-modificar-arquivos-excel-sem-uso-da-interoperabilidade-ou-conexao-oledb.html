<!DOCTYPE html>
<html>

<head>
	<!-- Meta -->
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="C# Brasil">

	<title>Manipulando arquivos Excel sem uso da interoperabilidade ou conexão OLEDB</title>

	<!-- CSS & fonts -->
	<link rel="stylesheet" href="/css/main.css?1716937206294534819">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,800" rel="stylesheet" type="text/css">

    <link rel="shortcut icon" href="/images/favicon.png" />
</head>


<body>
	<div id="wrap">
	  	
    <!-- Navigation -->
    <nav id="nav">
	<div id="nav-list">
		<a href="http://localhost:4000/">Página inicial</a>
		<a href="http://localhost:4000/sobre">Sobre o blog</a>
	</div>
</nav>

    
    <!-- Icon menu -->
	  <a id="nav-menu">
	  	<div id="menu"></div>
	  </a>
    <!-- Header -->
    <header id="header">
	<a href="http://localhost:4000/">
		<img src="/images/logo_csharpbrasil.png" class="logo" alt="C# Brasil">
	</a>
</header>

    <!-- Main content -->
	  <div id="container">
      <main>
        <article id="post-page">
	<h2>Manipulando arquivos Excel sem uso da interoperabilidade ou conexão OLEDB</h2>		
	<time datetime="2010-04-02T21:40:13-03:00" class="by-line">
		
		2
		Abril
		  
		2010
	</time>
	<div class="content">

		<p>Como é de costume, sempre compartilho a minhas experiências e necessidades do dia a dia com você.</p>

<p>Recentemente tive a necessidade de ler um arquivo Excel em um WebService, porem o servidor na qual está hospedado não possui o Office instalado e nem poderia porque no final das contas seria necessário instala-lo em 3 servidores.</p>

<p>Com isso comecei a procurar por soluções e até que cheguei a solução criada pelo chinês <a href="http://www.cnblogs.com/rufi/archive/2010/02/25/excellibrary.html">Liu Junfeng</a> que tambem possui uma materia no site do <a href="http://www.codeproject.com/kb/office/ExcelReader.aspx">Code Project</a> e seu fonte disponível no <a href="http://code.google.com/p/excellibrary/">Google Code</a>.</p>

<p>Os exemplos que se seguem poderão ser utilizado tanto em Windows Form quanto em Web Form. Então vamos ao que interessa.</p>

<h4 id="efetuando-a-leitura-de-um-arquivo-excel">Efetuando a leitura de um arquivo excel.</h4>

<p>Crie um novo ASP.NET Web Site.</p>

<p><a href="https://raphaelcardoso.com.br/wp-content/uploads/2010/04/excellibrary001-1.png"><img src="https://raphaelcardoso.com.br/wp-content/uploads/2010/04/excellibrary001-1-300x194.png" alt="" title="excellibrary001" /></a></p>

<p>Iremos fazer referência ao Excel Library em nosso projeto. Clique com o botão direito</p>

<p><a href="https://raphaelcardoso.com.br/wp-content/uploads/2010/04/excellibrary002-1.png"><img src="https://raphaelcardoso.com.br/wp-content/uploads/2010/04/excellibrary002-1-291x300.png" alt="" title="excellibrary002" /></a> <a href="https://raphaelcardoso.com.br/wp-content/uploads/2010/04/excellibrary003-1.png"><img src="https://raphaelcardoso.com.br/wp-content/uploads/2010/04/excellibrary003-1-300x253.png" alt="" title="excellibrary003" /></a></p>

<p>Adicione nele 1 FileUpload, 1 Button e 1 GridView. Nesse exemplo iremos fazer upload de um arquivo do Excel e exibi-lo em nosso GridView.</p>

<p><a href="https://raphaelcardoso.com.br/wp-content/uploads/2010/04/excellibrary004-1.png"><img src="https://raphaelcardoso.com.br/wp-content/uploads/2010/04/excellibrary004-1-300x202.png" alt="" title="excellibrary004" /></a></p>

<p>Agora vamos atribuir nosso código ao Button. Com isso, dé um duplo clique no Button e no evento dele criado iremos atribuir o código abaixo.</p>

<p>[sourcecode language=’csharp’] protected void btnProcessarExcel_Click(object sender, EventArgs e) { if (fupArquivo.HasFile) { // Recebe o arquivo em array de bytes byte[] buffer = fupArquivo.FileBytes; // Criar o arquivo em memoria System.IO.MemoryStream stream = new System.IO.MemoryStream(buffer); // Carrega o WorkBook do Excel ExcelLibrary.SpreadSheet.Workbook workbook = ExcelLibrary.SpreadSheet.Workbook.Load(stream); // Recupera o primeiro WorkSheet ExcelLibrary.SpreadSheet.Worksheet worksheet = workbook.Worksheets[0]; // Cria uma tabela para armazenar o Excel System.Data.DataTable dtExcel = new System.Data.DataTable(); dtExcel.Columns.Add(“Coluna0”, typeof(string)); dtExcel.Columns.Add(“Coluna1”, typeof(string)); // Percorre as linhas do Excel for (int rowIndex = worksheet.Cells.FirstRowIndex; rowIndex &lt;= worksheet.Cells.LastRowIndex; rowIndex++) { // Recupera a linha do Excel ExcelLibrary.SpreadSheet.Row row = worksheet.Cells.GetRow(rowIndex); // Adiciona os dados na tabela System.Data.DataRow newRow = dtExcel.NewRow(); newRow[“Coluna0”] = row.GetCell(0).StringValue; newRow[“Coluna1”] = row.GetCell(1).StringValue; dtExcel.Rows.Add(newRow); } // Adicona a tabela com os dados do Excel no Grid gridExcelProcessado.DataSource = dtExcel; gridExcelProcessado.DataBind(); } } [/sourcecode]</p>

<p>O código acima será executado quando o Button for clicado. O código irá verificar se o arquivo na qual foi feito o upload é válido e irá processa-lo. Os dados serão atribuidos em uma tabela para que possamos apresenta-lo em nosso Grid.</p>

<h4 id="criando-um-arquivo-excel">Criando um arquivo Excel</h4>

<p>Para criarmos um arquivo do Excel é bem mais simples. O código abaixo deixa isso bem claro. Instanciamos nosso WorkBook e WorkSheet e adicionamos os valores nas celular e para concluir adicionamos nosso WorkSheet no WorkBook e em seguida é só salvar.</p>

<p>[sourcecode language=’csharp’] string file = “C:\\excel_exemplo.xls”; ExcelLibrary.SpreadSheet.Workbook workbook = new ExcelLibrary.SpreadSheet.Workbook(); ExcelLibrary.SpreadSheet.Worksheet worksheet = new ExcelLibrary.SpreadSheet.Worksheet(“Planilha1”); worksheet.Cells[0, 0] = new ExcelLibrary.SpreadSheet.Cell(“Cliente1”); worksheet.Cells[0, 1] = new ExcelLibrary.SpreadSheet.Cell(“2344,89”); worksheet.Cells[1, 0] = new ExcelLibrary.SpreadSheet.Cell(“Cliente2”); worksheet.Cells[1, 1] = new ExcelLibrary.SpreadSheet.Cell(“1342,00”); worksheet.Cells[2, 0] = new ExcelLibrary.SpreadSheet.Cell(“Cliente3”); worksheet.Cells[2, 1] = new ExcelLibrary.SpreadSheet.Cell(“7634,78”); worksheet.Cells[3, 0] = new ExcelLibrary.SpreadSheet.Cell(“Cliente4”); worksheet.Cells[3, 1] = new ExcelLibrary.SpreadSheet.Cell(“4322,44”); workbook.Worksheets.Add(worksheet); workbook.Save(file); [/sourcecode]</p>

<p>Vale lembrar que o Excel Library é uma excelente alternativa, que no meu caso foi de grande ajuda.</p>

<p>Agora é só explorar os recursos e mão a obra.</p>

<p>Irei deixar para você o projeto criado no artigo para download <a href="https://raphaelcardoso.com.br/wp-content/uploads/2010/04/ExemploExcelLibrary-1.zip">aqui</a>.</p>

<p>Abraço e até a próxima.</p>

		
	</div>
</article>


      </main>		
      <!-- Pagination links -->
      
	  </div>
    
    <!-- Footer -->
    <footer class="footer"><span>&copy; 2024 C# Brasil. Todos os direitos reservados | Versão: 1.0.0 </span></footer>
    <!-- Script -->
    <script src="/js/main.js"></script>	

	</div>
</body>
</html>
