<!DOCTYPE html>
<html>

<head>
	<!-- Meta -->
	<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="C# Brasil">

	<title>Desenvolvimento de Website com ASP.NET e SQL Server - Parte 1</title>

	<!-- CSS & fonts -->
	<link rel="stylesheet" href="/css/main.css?1716937206294534819">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,300,600,800" rel="stylesheet" type="text/css">

    <link rel="shortcut icon" href="/images/favicon.png" />
</head>


<body>
	<div id="wrap">
	  	
    <!-- Navigation -->
    <nav id="nav">
	<div id="nav-list">
		<a href="http://localhost:4000/">Página inicial</a>
		<a href="http://localhost:4000/sobre">Sobre o blog</a>
	</div>
</nav>

    
    <!-- Icon menu -->
	  <a id="nav-menu">
	  	<div id="menu"></div>
	  </a>
    <!-- Header -->
    <header id="header">
	<a href="http://localhost:4000/">
		<img src="/images/logo_csharpbrasil.png" class="logo" alt="C# Brasil">
	</a>
</header>

    <!-- Main content -->
	  <div id="container">
      <main>
        <article id="post-page">
	<h2>Desenvolvimento de Website com ASP.NET e SQL Server - Parte 1</h2>		
	<time datetime="2012-01-22T16:10:05-02:00" class="by-line">
		
		22
		Janeiro
		  
		2012
	</time>
	<div class="content">

		<p>Olá caro leitor!</p>

<p>Estamos iniciando uma serie de artigos que tem como objetivo lhe mostrar o passo a passo da criação de um website utilizando ASP.NET e SQL Server.</p>

<p>Caso queira acessar as outras partes, veja os links abaixo:</p>

<ul>
  <li><a href="https://raphaelcardoso.com.br/desenvolvimento-de-website-com-asp-net-e-sql-server-parte-1/" title="Desenvolvimento de Website com ASP.NET e SQL Server – Parte 1">Desenvolvimento de Website com ASP.NET e SQL Server - Parte 1</a></li>
  <li><a href="https://raphaelcardoso.com.br/desenvolvimento-de-website-com-asp-net-e-sql-server-parte-2/" title="Desenvolvimento de Website com ASP.NET e SQL Server – Parte 2">Desenvolvimento de Website com ASP.NET e SQL Server - Parte 2</a></li>
  <li><a href="https://raphaelcardoso.com.br/desenvolvimento-de-website-com-asp-net-e-sql-server-parte-3/" title="Desenvolvimento de Website com ASP.NET e SQL Server – Parte 3">Desenvolvimento de Website com ASP.NET e SQL Server - Parte 3</a></li>
  <li><a href="https://raphaelcardoso.com.br/desenvolvimento-de-website-com-asp-net-e-sql-server-parte-4/" title="Desenvolvimento de Website com ASP.NET e SQL Server – Parte 4">Desenvolvimento de Website com ASP.NET e SQL Server - Parte 4</a></li>
  <li><a href="https://raphaelcardoso.com.br/desenvolvimento-de-website-com-asp-net-e-sql-server-parte-5/" title="Desenvolvimento de Website com ASP.NET e SQL Server – Parte 5">Desenvolvimento de Website com ASP.NET e SQL Server - Parte 5</a></li>
</ul>

<p>Nessa primeira parte iremos criar nosso banco de dados, as tabelas, camada de conexão, camada de entidades e a camada de regras de negocio. Então vamos ao que interessa.</p>

<p>Inicialmente criaremos o nosso banco de dados então para isso abra o <strong>Microsoft SQL Manager</strong> e crie-o conforme imagem abaixo.</p>

<p><a href="https://raphaelcardoso.com.br/wp-content/uploads/2012/01/imagem001.jpg"><img src="https://raphaelcardoso.com.br/wp-content/uploads/2012/01/imagem001-300x162.jpg" alt="" title="imagem001" /></a></p>

<p>Agora criaremos nossa tabela. A principio será somente 1 (uma) tabela. Segue abaixo o script:</p>

<p>[sourcecode language=’sql’] CREATE TABLE PAGINAS ( ID_PAGINA INT IDENTITY(1, 1) NOT NULL, TITULO_PAGINA VARCHAR(40) NOT NULL, TEXTO_PAGINA VARCHAR(MAX), DATACRIACAO_PAGINA DATETIME, ATIVO_PAGINA INT, PRIMARY KEY(ID_PAGINA) ) [/sourcecode]</p>

<p>Vamos inserir alguns dados iniciais.</p>

<p>[sourcecode language=’sql’] INSERT INTO PAGINAS(TITULO_PAGINA, TEXTO_PAGINA, DATACRIACAO_PAGINA, ATIVO_PAGINA) VALUES(‘Empresa’, ‘Conteudo da página sobre a empresa’, GETDATE(), 1) INSERT INTO PAGINAS(TITULO_PAGINA, TEXTO_PAGINA, DATACRIACAO_PAGINA, ATIVO_PAGINA) VALUES(‘Serviços’, ‘Conteudo da página de serviços’, GETDATE(), 1) [/sourcecode]</p>

<p>O fato de termos somente uma tabela é que nela teremos todas as páginas e seus conteúdos cadastrados. Nosso website terá a flexibilidade de criar, alterar, excluir e ativas ou desativas as páginas.</p>

<p>Futuramente criaremos uma pagina que listará produtos e para isso criaremos uma segunda tabela. Mais isso veremos em um próximo artigo.</p>

<p>Agora abra o Visual Studio e crie uma nova Solution clicando no menu <em>File &gt; New &gt; Project…</em></p>

<p><a href="https://raphaelcardoso.com.br/wp-content/uploads/2012/01/imagem002.jpg"><img src="https://raphaelcardoso.com.br/wp-content/uploads/2012/01/imagem002-300x185.jpg" alt="" title="imagem002" /></a></p>

<p>Para minha solution darei o nome de <em>ProjetoWebSite</em>.</p>

<p>Após isso, criaremos nosso primeiro. Esse projeto terá como objetivo a manipulação de dados utilizando o SQL Server.</p>

<p>Clique com o botão direito em cima da solution e clique na opção <em>Add &gt; New Project…</em></p>

<p><a href="https://raphaelcardoso.com.br/wp-content/uploads/2012/01/imagem003.jpg"><img src="https://raphaelcardoso.com.br/wp-content/uploads/2012/01/imagem003-300x162.jpg" alt="" title="imagem003" /></a></p>

<p>Feito isso, siga os passo conforme a imagem abaixo selecionando <em>Windows &gt; Class Librar_y e defina um nome para o projeto. No meu caso escolhi _WebSite.Data</em>.</p>

<p><a href="https://raphaelcardoso.com.br/wp-content/uploads/2012/01/imagem004.jpg"><img src="https://raphaelcardoso.com.br/wp-content/uploads/2012/01/imagem004-300x185.jpg" alt="" title="imagem004" /></a></p>

<p>Com nosso projeto da camada de conexão criada, iremos implementar alguns métodos. Basicamente serão 4 (quatro) métodos e 1 (uma) propriedade. Os 4 (quatro) métodos serão para abrir e fechar conexão, retornar os dados e outro pra executar comando. Vamos ao código.</p>

<table>
  <tbody>
    <tr>
      <td>[sourcecode language=’csharp’] using System; using System.Data; using System.Data.SqlClient; namespace WebSite.Data { public class Connection { private SqlConnection Conexao; /// /// Dados de conexao para SqlServer /// public string ConnectionString { get; set; } public Connection() { } /// /// Construtor que recebe como parametro a ConnectionString /// ///  public Connection(string ConnectionString) { this.ConnectionString = ConnectionString; } ///  /// Abre conexao ///  public void AbrirConexao() { if (string.IsNullOrEmpty(this.ConnectionString)) throw new Exception(“Não foi informado a ConnectionString.”); if (Conexao == null) { Conexao = new SqlConnection(); Conexao.ConnectionString = this.ConnectionString; } Conexao.Open(); } ///  /// Fecha conexao ///  public void FechaConexao() { if (Conexao != null &amp;&amp; Conexao.State == ConnectionState.Open) { Conexao.Close(); } } ///  /// Retorna os dados ///  ///  /// Retorna coleção de dados public IDataReader RetornaDados(string sql) { if (string.IsNullOrEmpty(sql)) throw new Exception(“Não foi informado a query SQL.”); if (Conexao == null</td>
      <td> </td>
      <td>Conexao.State == ConnectionState.Closed) throw new Exception(“A conexão fechada. Execute o comando AbrirConexao e não se esqueça de FecharConexao no final.”); SqlCommand command = new SqlCommand(); command.Connection = this.Conexao; command.CommandText = sql; IDataReader reader = command.ExecuteReader(); return reader; } ///  /// Executa comando ///  ///  /// Retorna o total de linhas afetadas public int ExecutaComando(string sql) { if (string.IsNullOrEmpty(sql)) throw new Exception(“Não foi informado a query SQL.”); if (Conexao == null</td>
      <td> </td>
      <td>Conexao.State == ConnectionState.Closed) throw new Exception(“A conexão fechada. Execute o comando AbrirConexao e não se esqueça de FecharConexao no final.”); SqlCommand command = new SqlCommand(); command.Connection = this.Conexao; command.CommandText = sql; int result = command.ExecuteNonQuery(); return result; } } } [/sourcecode]</td>
    </tr>
  </tbody>
</table>

<p>Para utilização da classe, será necessário instancia-la, executar o método para abrir conexão, executar os métodos para retornar os dados ou executar comando SQL e em seguida encerrar conexão.</p>

<p>Essa camada de conexão é simples, de fácil entendimento e pode ser utilizado em qualquer projeto.</p>

<p>Com nossa camada de conexão criada, vamos à camada de entidades onde teremos todas as entidades envolvidas no projeto e que é um espelho de nossas tabelas. Inicialmente teremos somente 1 (uma) entidade. Vamos criar um novo projeto.</p>

<p>Clique com o botão direito em cima da solution e clique na opção <em>Add &gt; New Project…</em></p>

<p><a href="https://raphaelcardoso.com.br/wp-content/uploads/2012/01/imagem005.jpg"><img src="https://raphaelcardoso.com.br/wp-content/uploads/2012/01/imagem005-300x162.jpg" alt="" title="imagem005" /></a></p>

<p>Feito isso, siga os passo conforme a imagem abaixo selecionando Windows &gt; Class Library e defina um nome para o projeto. No meu caso escolhi <em>WebSite.Entities</em>.</p>

<p><a href="https://raphaelcardoso.com.br/wp-content/uploads/2012/01/imagem006.jpg"><img src="https://raphaelcardoso.com.br/wp-content/uploads/2012/01/imagem006-300x185.jpg" alt="" title="imagem006" /></a></p>

<p>Agora vamos criar nossa entidade. Renomeie o arquivo <em>Class1.cs</em> para <em>Paginas.cs</em> que será um espelho da nossa tabela Paginas. Segue código abaixo.</p>

<p>[sourcecode language=’csharp’] using System; namespace WebSite.Entities { public class Paginas { public int Id { get; set; } public string Titulo { get; set; } public string Texto { get; set; } public DateTime DataCriacao { get; set; } public bool Ativo { get; set; } public Paginas() { } public Paginas(int Id) { this.Id = Id; } public Paginas(int Id, string Titulo, string Texto, DateTime DataCriacao, bool Ativo) { this.Id = Id; this.Titulo = Titulo; this.Texto = Texto; this.DataCriacao = DataCriacao; this.Ativo = Ativo; } } } [/sourcecode]</p>

<p>Com nossa camada de entidades criada, iremos cria camada de regra de negócios. Siga os passos abaixo.</p>

<p>Clique com o botão direito em cima da solution e clique na opção <em>Add &gt; New Project…</em></p>

<p><a href="https://raphaelcardoso.com.br/wp-content/uploads/2012/01/imagem007.jpg"><img src="https://raphaelcardoso.com.br/wp-content/uploads/2012/01/imagem007-300x162.jpg" alt="" title="imagem007" /></a></p>

<p>Feito isso, siga os passo conforme a imagem abaixo selecionando <em>Windows &gt; Class Library</em> e defina um nome para o projeto. No meu caso escolhi <em>WebSite.Business</em>.</p>

<p><a href="https://raphaelcardoso.com.br/wp-content/uploads/2012/01/imagem008.jpg"><img src="https://raphaelcardoso.com.br/wp-content/uploads/2012/01/imagem008-300x185.jpg" alt="" title="imagem008" /></a></p>

<p>Agora vamos criar as regras de negocio. Renomeie o arquivo <em>Class1.cs</em> para <em>Paginas.cs</em> que conterá todas as operações necessárias para manipularmos nossa tabela Paginas.</p>

<p>Antes de implementar os códigos, precisaremos adicionar como referencia ao nosso projeto as bibliotecas criadas anteriormente. Adicione a biblioteca <em>WebSite.Data</em> e <em>WebSite.Entities</em> clicando com botão direito em <em>References &gt; Add References &gt; Projects</em>. Na janela que segue selecione as 2 (duas) bibliotecas criadas.</p>

<p><a href="https://raphaelcardoso.com.br/wp-content/uploads/2012/01/imagem009.jpg"><img src="https://raphaelcardoso.com.br/wp-content/uploads/2012/01/imagem009-300x253.jpg" alt="" title="imagem009" /></a></p>

<p>Na classe <em>Paginas</em>, vamos adicionar as referencias.</p>

<p>[sourcecode language=’csharp’] using System.Configuration; using System.Data; [/sourcecode]</p>

<p>Agora implementaremos a nossas regras conforme o código abaixo.</p>

<p>[sourcecode language=’csharp’] using System; using System.Collections.Generic; using System.Text; using System.Configuration; using System.Data; namespace WebSite.Business { public class Paginas { private string ConnectionString = ConfigurationManager.ConnectionStrings[“DBConnection”].ConnectionString; public Paginas() { } public Entities.Paginas[] ListaPaginas() { return ListaPaginas(null); } public Entities.Paginas[] ListaPaginas(Entities.Paginas pagina) { List lstPaginas = new List(); Data.Connection connection = new Data.Connection(this.ConnectionString); connection.AbrirConexao(); StringBuilder sqlString = new StringBuilder(); sqlString.AppendLine(“select * from paginas”); if (pagina != null) { sqlString.AppendLine(“where 1 = 1”); if (pagina.Id &gt; 0) { sqlString.AppendLine(“and id_pagina = “ + pagina.Id + “”); } if (!string.IsNullOrEmpty(pagina.Titulo) &amp;&amp; pagina.Titulo.Length &gt; 0) { sqlString.AppendLine(“and titulo_pagina like ‘” + pagina.Titulo.Replace(“’”, “’’”) + “’”); } if (!string.IsNullOrEmpty(pagina.Texto) &amp;&amp; pagina.Texto.Length &gt; 0) { sqlString.AppendLine(“and texto_pagina like ‘” + pagina.Texto + “’”); } } IDataReader reader = connection.RetornaDados(sqlString.ToString()); int idxId = reader.GetOrdinal(“ID_PAGINA”); int idxTitulo = reader.GetOrdinal(“TITULO_PAGINA”); int idxTexto = reader.GetOrdinal(“TEXTO_PAGINA”); int idxDataCriacao = reader.GetOrdinal(“DATACRIACAO_PAGINA”); int idxAtivo = reader.GetOrdinal(“ATIVO_PAGINA”); while (reader.Read()) { Entities.Paginas _pagina = new Entities.Paginas(); _pagina.Id = reader.GetInt32(idxId); _pagina.Titulo = reader.GetString(idxTitulo); _pagina.Texto = reader.GetString(idxTexto); _pagina.DataCriacao = reader.GetDateTime(idxDataCriacao); _pagina.Ativo = reader.GetInt32(idxAtivo) == 1; lstPaginas.Add(_pagina); } connection.FechaConexao(); return lstPaginas.ToArray(); } public bool SalvaPagina(Entities.Paginas pagina) { bool salvou = false; if (pagina != null) { Data.Connection connection = new Data.Connection(this.ConnectionString); connection.AbrirConexao(); StringBuilder sqlString = new StringBuilder(); if (pagina.Id &gt; 0) { sqlString.AppendLine(“update paginas set”); sqlString.AppendLine(“titulo_pagina = ‘” + pagina.Titulo.Replace(“’”, “’’”) + “’,”); sqlString.AppendLine(“texto_pagina = ‘” + pagina.Texto.Replace(“’”, “’’”) + “’,”); sqlString.AppendLine(“ativo_pagina = “ + (pagina.Ativo ? 1 : 0) + “ “); sqlString.AppendLine(“where id_pagina = “ + pagina.Id + “”); } else { sqlString.AppendLine(“insert into paginas(titulo_pagina, texto_pagina, datacriacao_pagina, ativo_pagina)”); sqlString.AppendLine(“values(‘” + pagina.Titulo.Replace(“’”, “’’”) + “’, ‘” + pagina.Texto.Replace(“’”, “’’”) + “’, GETDATE(), “ + (pagina.Ativo ? 1 : 0) + “)”); } int i = connection.ExecutaComando(sqlString.ToString()); salvou = i &gt; 0; connection.FechaConexao(); } return salvou; } public bool SalvaPagina(int Id, string Titulo, string Texto, DateTime DataCriacao, bool Ativo) { return SalvaPagina(new Entities.Paginas(Id, Titulo, Texto, DataCriacao, Ativo)); } public bool ExcluiPagina(Entities.Paginas pagina) { bool salvou = false; if (pagina != null &amp;&amp; pagina.Id &gt; 0) { Data.Connection connection = new Data.Connection(this.ConnectionString); connection.AbrirConexao(); StringBuilder sqlString = new StringBuilder(); sqlString.AppendLine(“delete from paginas”); sqlString.AppendLine(“where id_pagina = “ + pagina.Id + “”); int i = connection.ExecutaComando(sqlString.ToString()); connection.FechaConexao(); } return salvou; } public bool ExcluiPagina(int Id) { return ExcluiPagina(new Entities.Paginas(Id)); } } } [/sourcecode]</p>

<p>Como pode ver, até aqui somente criamos as classes que iremos utilizar em nosso Website. Até momento nosso projeto ficou da seguinte forma.</p>

<ul>
  <li><strong>WebSite.Data:</strong> Camada responsável por abrir conexão, executar comandos SQL, retornar dados e encerrar conexão.</li>
  <li><strong>WebSite.Entities:</strong> Camada responsável por manter nossas entidades que serão utilizadas em todo o projeto.</li>
  <li><strong>WebSite.Business:</strong> Camada responsável em conter todas as operações possíveis, ou seja, ela conterá no mínimo as quatro operações básicas: Criar (Create), Ler (Read), Atualizar (Update) e Excluir (Delete).</li>
</ul>

<p>Com o que já criamos, é possível também reutiliza-lo em um projeto do tipo WinForm (Windows Form), porem nosso foco será o desenvolvimento de um website.</p>

<p>Vale lembrar também que a camada de conexão de dados pode ser reutilizada e modificada para a utilização de outros bancos de dados. Modificando você poderá usar os seguintes:</p>

<ul>
  <li>System.Data.OleDb</li>
  <li>System.Data.OracleClient</li>
  <li>MySql.Data.MySqlClient</li>
  <li>System.Data.SQLite</li>
  <li>FirebirdSql.Data.FirebirdClient</li>
</ul>

<p>Espero que com esse primeiro artigo da serie, você possa ter uma visão melhor sobre o desenvolvimento de projetos N-Camadas e com ele ter base para iniciar outros projetos com maior facilidade e com uma visão mais ampla do todo.</p>

<p>No próximo artigo iniciaremos a criação de nosso website.</p>

<p>Fonte do projeto: <a href="https://github.com/csharpbrasil/projeto-website-aspnet">Github</a></p>

<p>Não deixe de participar do fórum. Siga o C# Brasil no Twitter e Facebook.</p>

<p>Até o próximo artigo e bons estudos!</p>

		
	</div>
</article>


      </main>		
      <!-- Pagination links -->
      
	  </div>
    
    <!-- Footer -->
    <footer class="footer"><span>&copy; 2024 C# Brasil. Todos os direitos reservados | Versão: 1.0.0 </span></footer>
    <!-- Script -->
    <script src="/js/main.js"></script>	

	</div>
</body>
</html>
